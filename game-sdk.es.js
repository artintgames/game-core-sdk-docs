const ee="https://stage-configs.artintgames.com",te="https://stage-auth.artintgames.com",se="https://stage-profile.artintgames.com",u={configUrl:ee,authUrl:te,profileUrl:se};function R(e){u.configUrl=e}function $(e){u.authUrl=e}function B(e){u.profileUrl=e}const N="coreSDK_profiles_v1",ie=100,C=3e5;class ne{constructor(e){this.items=new Map,this.maxItems=e?.maxItems??ie,this.loadFromStorage()}get(e){const t=this.items.get(e);if(!t)return null;const s=Date.now();return s-t.cachedAt>t.ttl?(this.items.delete(e),this.saveToStorageSafe(),null):(t.lastAccessed=s,t.profile)}set(e,t){const s=Date.now(),n={profile:e,cachedAt:s,lastAccessed:s,ttl:t};this.items.set(e.id,n),this.evictIfNeeded(),this.saveToStorageSafe()}invalidate(e){this.items.delete(e)&&this.saveToStorageSafe()}invalidateAll(){this.items.clear(),this.saveToStorageSafe()}evictIfNeeded(){if(this.items.size<=this.maxItems)return;const e=Array.from(this.items.entries());e.sort((e,t)=>e[1].lastAccessed-t[1].lastAccessed);const t=e.length-this.maxItems;for(let s=0;s<t;s++){const[t]=e[s];this.items.delete(t)}}loadFromStorage(){if(!(typeof localStorage>"u"))try{const e=localStorage.getItem(N);if(!e)return;const t=JSON.parse(e);if(1!==t.version||!t.items||"object"!=typeof t.items)return;const s=Date.now();for(const[e,n]of Object.entries(t.items))!n||!n.profile||"number"!=typeof n.cachedAt||"number"!=typeof n.ttl||s-n.cachedAt>n.ttl||this.items.set(e,n);this.evictIfNeeded()}catch(e){console.error("[ProfileCache] loadFromStorage error:",e)}}saveToStorageSafe(){if(!(typeof localStorage>"u"))try{const e={};for(const[t,s]of this.items.entries())e[t]=s;const t={version:1,items:e};localStorage.setItem(N,JSON.stringify(t))}catch(e){console.error("[ProfileCache] saveToStorageSafe error:",e)}}}const A={PROFILE_UPDATED:"profile.updated"};class w{constructor(e,t){this.cache=new ne,this.myProfileId=null,this.getAuthToken=e,this.events=t}buildUrl(e){return`${u.authUrl.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e);let n=this.getAuthToken();!n&&typeof localStorage<"u"&&(n=localStorage.getItem("coreSDK_token")||void 0);const i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:i,credentials:"include"});if(!o.ok){const e=await o.text();let t=`Request failed with status ${o.status}`;try{const s=JSON.parse(e);Array.isArray(s.message)?t=s.message.join(", "):s.message?t=s.message:s.error&&(t=s.error)}catch{}throw new Error(t)}const r=await o.text();return r?JSON.parse(r):null}emitUpdate(e){this.events.emit(A.PROFILE_UPDATED,{id:e.id,profile:e}),typeof window<"u"&&window.dispatchEvent(new CustomEvent(A.PROFILE_UPDATED,{detail:{id:e.id,profile:e}}))}async getProfile(){if(this.myProfileId){const e=this.cache.get(this.myProfileId);if(e)return e}const e=await this.request("/v1/auth/me");return this.myProfileId=e.id,this.cache.set(e,C),e}async getProfileField(e){return(await this.request(`/v1/profiles/me/field/${e}`)).value}async updateProfile(e){const t=await this.request("/v1/profiles/me",{method:"PATCH",body:JSON.stringify(e)});return this.myProfileId=t.id,this.cache.set(t,C),this.emitUpdate(t),t}async setProfileField(e,t){const s=await this.request(`/v1/profiles/me/field/${e}`,{method:"PUT",body:JSON.stringify({value:t})});return this.myProfileId&&this.cache.invalidate(this.myProfileId),s.value}async mergeProfileScope(e,t){const s=await this.request(`/v1/profiles/me/scope/${e}`,{method:"PATCH",body:JSON.stringify({data:t})});return this.myProfileId=s.id,this.cache.set(s,C),this.emitUpdate(s),s}invalidate(e){e?this.cache.invalidate(e):this.myProfileId&&this.cache.invalidate(this.myProfileId)}invalidateAll(){this.cache.invalidateAll()}resetMyProfileId(){this.myProfileId=null}}class re{constructor(e){this.getAuthToken=e}buildUrl(e){return`${u.configUrl.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`),console.log("[API] REQUEST:",{url:s,method:t.method??"GET",headers:i,body:t.body});const o=await fetch(s,{...t,headers:i,credentials:"include"});if(!o.ok){const e=await o.text().catch(()=>"");throw console.error("[API] Request failed:",{url:s,status:o.status,body:e}),new Error(`Request failed with status ${o.status}`)}const r=await o.text();if(!r)return null;try{return JSON.parse(r)}catch(e){return console.warn("[API] Response is not JSON, returning as text:",e),r}}normalizeBody(e){return void 0===e?void 0:JSON.stringify(e)}send(e,t,s){return this.request(t,{method:e,body:this.normalizeBody(s)})}get(e){return this.send("GET",e)}post(e,t){return this.send("POST",e,t)}put(e,t){return this.send("PUT",e,t)}patch(e,t){return this.send("PATCH",e,t)}delete(e){return this.send("DELETE",e)}}class oe{constructor(){this.listeners=new Map,this.onceListeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}once(e,t){this.onceListeners.has(e)||this.onceListeners.set(e,new Set),this.onceListeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t),this.onceListeners.get(e)?.delete(t)}emit(e,...t){this.listeners.get(e)?.forEach(e=>e(...t));const s=this.onceListeners.get(e);s&&(s.forEach(e=>e(...t)),this.onceListeners.delete(e))}}const M="https://accounts.google.com/gsi/client",O=class{static async loadScript(){if(typeof window>"u")throw new Error("GoogleAuthHelper requires browser environment");if(!window.google?.accounts?.id)return this.scriptLoading||(this.scriptLoading=new Promise((e,t)=>{const s=document.querySelector(`script[src="${M}"]`);if(s)return s.addEventListener("load",()=>e()),void s.addEventListener("error",()=>t(new Error("Failed to load Google Sign-In")));const n=document.createElement("script");n.src=M,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Google Sign-In")),document.head.appendChild(n)})),this.scriptLoading}static requestToken(e,t){return new Promise((s,n)=>{window.google?.accounts?.id?(window.google.accounts.id.initialize({client_id:e,callback:e=>{e.credential?s(e):n(new Error("No credential received from Google"))},auto_select:!1,cancel_on_tap_outside:!1}),t?.useOneTap?window.google.accounts.id.prompt(e=>{if(e.isNotDisplayed()||e.isSkippedMoment()){const t=e.isNotDisplayed()?e.getNotDisplayedReason():e.getSkippedReason();n(new Error(`Google One Tap unavailable: ${t}. Try without useOneTap option.`))}}):this.triggerButtonPopup(e,s,n)):n(new Error("Google Identity Services not loaded"))})}static triggerButtonPopup(e,t,s){const n=document.createElement("div");n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let i=!1;const o=()=>{n.parentNode&&n.parentNode.removeChild(n)},r=setTimeout(()=>{i||(o(),s(new Error("Google Sign-In timeout or cancelled by user")))},12e4);window.google.accounts.id.initialize({client_id:e,callback:e=>{i=!0,clearTimeout(r),o(),e.credential?t(e):s(new Error("No credential received from Google"))}}),window.google.accounts.id.renderButton(n,{type:"standard",size:"large",click_listener:()=>{console.log("[GoogleAuthHelper] Button clicked, waiting for response...")}}),requestAnimationFrame(()=>{const e=n.querySelector("div[role='button']");if(e)e.click();else{const e=n.querySelector("*");e&&e.click()}})}static isAvailable(){return typeof window<"u"&&!!window.google?.accounts?.id}static cancel(){window.google?.accounts?.id&&window.google.accounts.id.cancel()}};O.scriptLoading=null;let D=O;class ae{constructor(e){this.backdrop=null,this.options=e}show(){this.backdrop||(this.backdrop=document.createElement("div"),this.backdrop.className="coresdk-auth-backdrop",this.backdrop.innerHTML=this.getHTML(),this.injectStyles(),document.body.appendChild(this.backdrop),this.attachEvents())}hide(){this.backdrop&&(this.backdrop.remove(),this.backdrop=null)}getHTML(){return`\n            <div class="coresdk-auth-modal">\n                <h2 class="coresdk-auth-title">Choose Sign In Method</h2>\n                <p class="coresdk-auth-subtitle">Select how you want to continue</p>\n\n                <div class="coresdk-auth-buttons">\n                    <button\n                        class="coresdk-auth-btn coresdk-auth-btn-google"\n                        data-action="google"\n                        ${!1===this.options.googleEnabled?"disabled":""}\n                    >\n                        <svg viewBox="0 0 24 24" width="20" height="20">\n                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>\n                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>\n                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>\n                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>\n                        </svg>\n                        <span>Continue with Google</span>\n                    </button>\n\n                    <button class="coresdk-auth-btn coresdk-auth-btn-guest" data-action="guest">\n                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">\n                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>\n                        </svg>\n                        <span>Continue as Guest</span>\n                    </button>\n                </div>\n\n                <p class="coresdk-auth-hint">\n                    Guest accounts are linked to this device\n                </p>\n            </div>\n        `}injectStyles(){if(document.getElementById("coresdk-auth-styles"))return;const e=document.createElement("style");e.id="coresdk-auth-styles",e.textContent="\n            .coresdk-auth-backdrop {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.5);\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                z-index: 999999;\n                animation: coresdk-fadeIn 0.2s ease;\n            }\n\n            @keyframes coresdk-fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n\n            @keyframes coresdk-slideUp {\n                from {\n                    opacity: 0;\n                    transform: translateY(20px) scale(0.95);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0) scale(1);\n                }\n            }\n\n            .coresdk-auth-modal {\n                background: #fff;\n                border-radius: 16px;\n                padding: 32px;\n                width: 340px;\n                max-width: 90vw;\n                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n                animation: coresdk-slideUp 0.3s ease;\n            }\n\n            .coresdk-auth-title {\n                margin: 0 0 8px;\n                font-size: 22px;\n                font-weight: 600;\n                color: #1a1a1a;\n                text-align: center;\n                font-family: system-ui, -apple-system, sans-serif;\n            }\n\n            .coresdk-auth-subtitle {\n                margin: 0 0 24px;\n                font-size: 14px;\n                color: #666;\n                text-align: center;\n                font-family: system-ui, -apple-system, sans-serif;\n            }\n\n            .coresdk-auth-buttons {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n\n            .coresdk-auth-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 12px;\n                padding: 14px 20px;\n                border-radius: 12px;\n                font-size: 15px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                border: none;\n                font-family: system-ui, -apple-system, sans-serif;\n            }\n\n            .coresdk-auth-btn:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n\n            .coresdk-auth-btn-google {\n                background: #fff;\n                border: 1px solid #ddd;\n                color: #333;\n            }\n\n            .coresdk-auth-btn-google:hover:not(:disabled) {\n                background: #f8f8f8;\n                border-color: #ccc;\n                transform: translateY(-1px);\n            }\n\n            .coresdk-auth-btn-guest {\n                background: #333;\n                color: #fff;\n            }\n\n            .coresdk-auth-btn-guest:hover:not(:disabled) {\n                background: #444;\n                transform: translateY(-1px);\n            }\n\n            .coresdk-auth-btn svg {\n                flex-shrink: 0;\n            }\n\n            .coresdk-auth-hint {\n                margin: 20px 0 0;\n                font-size: 12px;\n                color: #999;\n                text-align: center;\n                font-family: system-ui, -apple-system, sans-serif;\n            }\n\n            .coresdk-auth-btn.loading {\n                pointer-events: none;\n                opacity: 0.7;\n            }\n\n            .coresdk-auth-btn.loading span {\n                opacity: 0.5;\n            }\n        ",document.head.appendChild(e)}attachEvents(){if(!this.backdrop)return;const e=this.backdrop.querySelector('[data-action="google"]'),t=this.backdrop.querySelector('[data-action="guest"]');e?.addEventListener("click",async()=>{if(!e.disabled){e.classList.add("loading");try{await this.options.onGoogleClick(),this.hide()}catch(t){console.error("[AuthModal] Google auth error:",t),e.classList.remove("loading")}}}),t?.addEventListener("click",async()=>{t.classList.add("loading");try{await this.options.onGuestClick(),this.hide()}catch(e){console.error("[AuthModal] Guest auth error:",e),t.classList.remove("loading")}}),this.backdrop.addEventListener("click",e=>{e.target===this.backdrop&&(this.hide(),this.options.onClose?.())})}}const m=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,h=globalThis,S="10.27.0";function V(){return x(h),h}function x(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||S,t[S]=t[S]||{}}function K(e,t,s=h){const n=s.__SENTRY__=s.__SENTRY__||{},i=n[S]=n[S]||{};return i[e]||(i[e]=t())}const ce="Sentry Logger ",q={};function le(e){if(!("console"in h))return e();const t=h.console,s={},n=Object.keys(q);n.forEach(e=>{const n=q[e];s[e]=t[e],t[e]=n});try{return e()}finally{n.forEach(e=>{t[e]=s[e]})}}function de(){P().enabled=!0}function ue(){P().enabled=!1}function Y(){return P().enabled}function he(...e){I("log",...e)}function ge(...e){I("warn",...e)}function pe(...e){I("error",...e)}function I(e,...t){m&&Y()&&le(()=>{h.console[e](`${ce}[${e}]:`,...t)})}function P(){return m?K("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const k={enable:de,disable:ue,isEnabled:Y,log:he,warn:ge,error:pe},fe=Object.prototype.toString;function me(e,t){return fe.call(e)===`[object ${t}]`}function ye(e){return me(e,"Object")}function Se(e){return!(!e?.then||"function"!=typeof e.then)}function ve(e,t,s){try{Object.defineProperty(e,t,{value:s,writable:!0,configurable:!0})}catch{m&&k.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function be(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function we(){const e=h;return e.crypto||e.msCrypto}let E;function _e(){return 16*Math.random()}function v(e=we()){try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"")}catch{}return E||(E="10000000100040008000100000000000"),E.replace(/[018]/g,e=>(e^(15&_e())>>e/4).toString(16))}const Q=1e3;function X(){return Date.now()/Q}function ke(){const{performance:e}=h;if(!e?.now||!e.timeOrigin)return X;const t=e.timeOrigin;return()=>(t+e.now())/Q}let F;function De(){return(F??(F=ke()))()}function Ce(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||De(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:v()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}function Z(e,t,s=2){if(!t||"object"!=typeof t||s<=0)return t;if(e&&0===Object.keys(t).length)return e;const n={...e};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=Z(n[e],t[e],s-1));return n}function J(){return v()}const T="_sentrySpan";function z(e,t){t?ve(e,T,t):delete e[T]}function j(e){return e[T]}const Ee=100;class g{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:J(),sampleRand:Math.random()}}clone(){const e=new g;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._attributes={...this._attributes},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,z(e,j(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Ce(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this.setTags({[e]:t})}setAttributes(e){return this._attributes={...this._attributes,...e},this._notifyScopeListeners(),this}setAttribute(e,t){return this.setAttributes({[e]:t})}removeAttribute(e){return e in this._attributes&&(delete this._attributes[e],this._notifyScopeListeners()),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,s=t instanceof g?t.getScopeData():ye(t)?e:void 0,{tags:n,attributes:i,extra:o,user:r,contexts:a,level:c,fingerprint:l=[],propagationContext:d}=s||{};return this._tags={...this._tags,...n},this._attributes={...this._attributes,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...a},r&&Object.keys(r).length&&(this._user=r),c&&(this._level=c),l.length&&(this._fingerprint=l),d&&(this._propagationContext=d),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,z(this,void 0),this._attachments=[],this.setPropagationContext({traceId:J(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const s="number"==typeof t?t:Ee;if(s<=0)return this;const n={timestamp:X(),...e,message:e.message?be(e.message,2048):e.message};return this._breadcrumbs.push(n),this._breadcrumbs.length>s&&(this._breadcrumbs=this._breadcrumbs.slice(-s),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:j(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Z(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const s=t?.event_id||v();if(!this._client)return m&&k.warn("No client configured on scope - will not capture exception!"),s;const n=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:n,...t,event_id:s},this),s}captureMessage(e,t,s){const n=s?.event_id||v();if(!this._client)return m&&k.warn("No client configured on scope - will not capture message!"),n;const i=s?.syntheticException??new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...s,event_id:n},this),n}captureEvent(e,t){const s=t?.event_id||v();return this._client?(this._client.captureEvent(e,{...t,event_id:s},this),s):(m&&k.warn("No client configured on scope - will not capture event!"),s)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function Ae(){return K("defaultCurrentScope",()=>new g)}function Te(){return K("defaultIsolationScope",()=>new g)}class xe{constructor(e,t){let s,n;s=e||new g,n=t||new g,this._stack=[{scope:s}],this._isolationScope=n}withScope(e){const t=this._pushScope();let s;try{s=e(t)}catch(e){throw this._popScope(),e}return Se(s)?s.then(e=>(this._popScope(),e),e=>{throw this._popScope(),e}):(this._popScope(),s)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1||!this._stack.pop())}}function y(){const e=x(V());return e.stack=e.stack||new xe(Ae(),Te())}function Ke(e){return y().withScope(e)}function Ie(e,t){const s=y();return s.withScope(()=>(s.getStackTop().scope=e,t(e)))}function H(e){return y().withScope(()=>e(y().getIsolationScope()))}function Pe(){return{withIsolationScope:H,withScope:Ke,withSetScope:Ie,withSetIsolationScope:(e,t)=>H(t),getCurrentScope:()=>y().getScope(),getIsolationScope:()=>y().getIsolationScope()}}function Ue(e){const t=x(e);return t.acs?t.acs:Pe()}function Ge(){return Ue(V()).getCurrentScope()}function Oe(e,t){return Ge().captureException(e,void 0)}class Le{constructor(e){this.apiClient=e}async init(e){return this.apiClient.post("/v1/configs/get-init",e)}async fetch(e){return this.apiClient.post("/v1/configs/get-fetch",e)}}class Re{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/ab-tests")}async getActive(){return this.apiClient.get("/v1/ab-tests/active")}async getById(e){return this.apiClient.get(`/v1/ab-tests/${e}`)}async getVariant(e){return this.apiClient.get(`/v1/ab-tests/${e}/variant`)}async create(e){return this.apiClient.post("/v1/ab-tests",e)}async update(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PUT",body:JSON.stringify(t)})}async patch(e,t){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/ab-tests/${e}`,{method:"DELETE"})}}class $e{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/remote-configs")}async getById(e){return this.apiClient.get(`/v1/remote-configs/${e}`)}async create(e){return this.apiClient.post("/v1/remote-configs",e)}async update(e,t){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/remote-configs/${e}`,{method:"DELETE"})}async refresh(){return this.apiClient.post("/v1/remote-configs/refresh",{})}}class Be{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/segments")}async getById(e){return this.apiClient.get(`/v1/segments/${e}`)}async getUserSegments(){return this.apiClient.get("/v1/segments/user")}async create(e){return this.apiClient.post("/v1/segments",e)}async update(e,t){return this.apiClient.request(`/v1/segments/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.apiClient.request(`/v1/segments/${e}`,{method:"DELETE"})}}class Ne{constructor(e){this.getAuthToken=e}buildUrl(e){return`${u.authUrl.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:i,credentials:"include"});if(!o.ok){const e=await o.text();let t=`Request failed with status ${o.status}`;try{const s=JSON.parse(e);Array.isArray(s.message)?t=s.message.join(", "):s.message?t=s.message:s.error&&(t=s.error)}catch{}throw new Error(t)}const r=await o.text();return r?JSON.parse(r):null}async getAll(){return this.request("/v1/users")}async getById(e){return this.request(`/v1/users/${e}`)}async search(e){return this.request(`/v1/users/search?q=${encodeURIComponent(e)}`)}async create(e){return this.request("/v1/users",{method:"POST",body:JSON.stringify(e)})}async update(e,t){return this.request(`/v1/users/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async delete(e){return this.request(`/v1/users/${e}`,{method:"DELETE"})}}class Me{constructor(e){this.apiClient=e}async getVersion(){return this.apiClient.get("/v1")}async check(){return this.apiClient.get("/v1/health")}async detailed(){return this.apiClient.get("/v1/health/detailed")}}class qe{constructor(e){this.getAuthToken=e}buildUrl(e){return`${u.authUrl.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e);let n=this.getAuthToken();!n&&typeof localStorage<"u"&&(n=localStorage.getItem("coreSDK_token")||void 0);const i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:i,credentials:"include"});if(!o.ok){const e=await o.text();let t=`Request failed with status ${o.status}`;try{const s=JSON.parse(e);Array.isArray(s.message)?t=s.message.join(", "):s.message&&(t=s.message)}catch{}throw new Error(t)}const r=await o.text();return r?JSON.parse(r):null}async init(e){return this.request("/v1/auth/init",{method:"POST",body:JSON.stringify(e)})}async signin(e){return this.request("/v1/auth/signin",{method:"POST",body:JSON.stringify(e)})}async confirmCode(e){return this.request("/v1/auth/code",{method:"POST",body:JSON.stringify(e)})}async logout(){try{await this.request("/v1/auth/logout",{method:"POST"})}catch{}}async getOAuthConfig(){return this.request("/v1/auth/oauth/config",{method:"GET"})}async googleSignIn(e,t){return this.init({...t,et:e,pr:"google"})}async health(){return this.request("/v1/health",{method:"GET"})}}class Fe{constructor(e){this.getAuthToken=e}buildUrl(e){return`${u.configUrl.replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:i,credentials:"include"});if(!o.ok){const e=await o.text();let t=`Request failed with status ${o.status}`;try{const s=JSON.parse(e);Array.isArray(s.message)?t=s.message.join(", "):s.message&&(t=s.message)}catch{}throw new Error(t)}const r=await o.text();return r?JSON.parse(r):null}async list(e){const t=e?`?pattern=${encodeURIComponent(e)}`:"";return this.request(`/v1/player-kv/list${t}`,{method:"GET"})}async get(e){return this.request(`/v1/player-kv/get/${encodeURIComponent(e)}`,{method:"GET"})}async set(e,t,s){return this.request("/v1/player-kv/set",{method:"POST",body:JSON.stringify({key:e,value:t,ttl:s})})}async delete(e){return this.request(`/v1/player-kv/${encodeURIComponent(e)}`,{method:"DELETE"})}async exists(e){return this.request(`/v1/player-kv/exists/${encodeURIComponent(e)}`,{method:"GET"})}async getMany(e){const t={},s=e.map(async e=>{try{const s=await this.get(e);t[e]=s.value}catch{t[e]=null}});return await Promise.all(s),t}async setMany(e,t){const s=Object.entries(e).map(([e,s])=>this.set(e,s,t));await Promise.all(s)}async deleteMany(e){const t=e.map(e=>this.delete(e));await Promise.all(t)}}class Je{constructor(e){this.apiClient=e}async getAll(){return this.apiClient.get("/v1/events")}async send(e){return this.apiClient.post("/v1/events",e)}}const U="1.0.80",G=[U,"1.0.3","1.0.0"];function ze(e){return G.includes(e)}function je(e){if(!ze(e)){const t=G.join(", ");throw new Error(`[SDK] Unsupported version "${e}". Supported versions: ${t}. Current SDK version: ${U}`)}}class He{constructor(e){this.getAuthToken=e}buildUrl(e){return`${(u.profileUrl||u.configUrl).replace(/\/+$/,"")}/${e.replace(/^\/+/,"")}`}async request(e,t={}){const s=this.buildUrl(e),n=this.getAuthToken(),i={"Content-Type":"application/json",...t.headers};n&&(i.Authorization=`Bearer ${n}`);const o=await fetch(s,{...t,headers:i});if(!o.ok){const e=await o.text();let t=`Request failed with status ${o.status}`;try{const s=JSON.parse(e);s.message&&(t=s.message)}catch{}throw new Error(t)}const r=await o.text();return r?JSON.parse(r):null}async get(){return this.request("/v1/state",{method:"GET"})}async update(e){return this.request("/v1/state",{method:"PUT",body:JSON.stringify({meta:e})})}async getProfile(){return this.request("/v1/profile",{method:"GET"})}async updateProfile(e){return this.request("/v1/profile",{method:"PATCH",body:JSON.stringify(e)})}async getField(e){return this.request(`/v1/profile/field/${e}`,{method:"GET"})}async setField(e,t){return this.request(`/v1/profile/field/${e}`,{method:"PUT",body:JSON.stringify({value:t})})}async kvList(){return this.request("/v1/kv/list",{method:"GET"})}async kvGet(e){return this.request(`/v1/kv/${e}`,{method:"GET"})}async kvSet(e,t,s){await this.request("/v1/kv/set",{method:"POST",body:JSON.stringify({key:e,value:t,ttl:s})})}async kvDelete(e){return this.request(`/v1/kv/${e}`,{method:"DELETE"})}async kvExists(e){return this.request(`/v1/kv/exists/${e}`,{method:"GET"})}}class W{constructor(e,t){this.response=e,this.configs=t}get(e){const t=this.parsePath(e);if(0===t.length)return;const[s,...n]=t;let i=this.configs[s];for(const e of n){if(null==i)return;i=i[e]}return i}has(e){return void 0!==this.get(e)}keys(){const e=[];for(const t of Object.keys(this.configs))for(const s of Object.keys(this.configs[t]))e.push(`${t}.${s}`);return e}values(){const e=[];for(const t of Object.values(this.configs))for(const s of Object.values(t))e.push(s);return e}getAll(){return this.configs}getScope(e){return this.configs[e]}getMeta(){return{segment:this.response.segment,ab:this.response.ab,abG:this.response.abG,abExp:this.response.abExp}}raw(){return this.response}parsePath(e){return e.split(/\.|\[|\]/).filter(Boolean).map(e=>{const t=parseInt(e,10);return isNaN(t)?e:t})}}const p={AUTH_SUCCESS:"core:authSuccess",AUTH_ERROR:"core:authError"},_={ios:1,android:2,web:3,windows:3,macos:3,linux:3,unknown:3};class f{constructor(){this.eventBus=new oe,this.systemParams={},this.initialized=!1,this.oauthConfig=null,this.configState={configs:{}},this.detectEnvironment();try{const e=localStorage.getItem("coreSDK_token");e&&(this.systemParams.authToken=e,console.log("[SDK] constructor: restored token from localStorage"));const t=localStorage.getItem("coreSDK_configUrl"),s=localStorage.getItem("coreSDK_authUrl"),n=localStorage.getItem("coreSDK_profileUrl");t&&(R(t),console.log("[SDK] constructor: restored configUrl from localStorage")),s&&($(s),console.log("[SDK] constructor: restored authUrl from localStorage")),n&&(B(n),console.log("[SDK] constructor: restored profileUrl from localStorage"))}catch(e){console.error("[SDK] constructor: failed to restore state:",e)}this.apiClient=new re(()=>this.systemParams.authToken),this.configs=new Le(this.apiClient),this.abTests=new Re(this.apiClient),this.remoteConfigs=new $e(this.apiClient),this.segments=new Be(this.apiClient),this.users=new Ne(()=>this.systemParams.authToken),this.health=new Me(this.apiClient),this.auth=new qe(()=>this.systemParams.authToken),this.playerKv=new Fe(()=>this.systemParams.authToken),this.events=new Je(this.apiClient),this.profileClient=new w(()=>this.systemParams.authToken,this.eventBus),this.profileApi=new He(()=>this.systemParams.authToken),this.gamestate=this.profileApi}static getInstance(){return f.instance||(f.instance=new f),f.instance}async init(e,t){if(console.log(`[SDK] v${U} init: start`,e),e?.version){console.log(`[SDK] init: validating app version "${e.version}"...`);try{je(e.version),console.log(`[SDK] init: app version "${e.version}" is supported`)}catch(e){throw console.error(`[SDK] init: VERSION ERROR - ${e.message}`),console.error(`[SDK] init: Supported versions: ${G.join(", ")}`),e}}if(this.initialized)return console.log("[SDK] init: already initialized, skipping"),void(t&&this.isAuthenticated()&&(console.log("[SDK] init: already authenticated, calling onAuthReady"),t()));e?.configUrl&&(console.log("[SDK] init: set base url ->",e.configUrl),R(e.configUrl),this.storeUrl("coreSDK_configUrl",e.configUrl)),e?.authUrl&&(console.log("[SDK] init: set auth url ->",e.authUrl),$(e.authUrl),this.storeUrl("coreSDK_authUrl",e.authUrl)),e?.profileUrl&&(console.log("[SDK] init: set profile url ->",e.profileUrl),B(e.profileUrl),this.storeUrl("coreSDK_profileUrl",e.profileUrl));const s=this.getStoredToken();if(s)return console.log("[SDK] init: restoring token from localStorage"),this.systemParams.authToken=s,this.profileClient=new w(()=>this.systemParams.authToken,this.eventBus),this.initialized=!0,console.log("[SDK] init: restored session, SDK ready"),void(t&&(console.log("[SDK] init: calling onAuthReady after token restore"),t()));if(this.systemParams.authToken)return console.log("[SDK] init: token already set, SDK ready"),this.profileClient=new w(()=>this.systemParams.authToken,this.eventBus),this.initialized=!0,void(t&&(console.log("[SDK] init: calling onAuthReady (token already set)"),t()));try{console.log("[SDK] init: set system params ->",e),e&&this.setSystemParams(e),console.log("[SDK] init: ensure device id…");const s=await this.ensureDeviceId();console.log("[SDK] init: deviceId =",s),this.systemParams.deviceId=s,e?.skipAuth?console.log("[SDK] init: skipAuth=true, skipping auth"):this.isAuthenticated()?console.log("[SDK] init: already authenticated, skipping auth modal"):(console.log("[SDK] init: showing auth modal…"),await this.showAuthModal(),console.log("[SDK] init: auth completed")),this.profileClient=new w(()=>this.systemParams.authToken,this.eventBus),console.log("[SDK] init: profile module initialized"),this.on(A.PROFILE_UPDATED,e=>{try{const t=e?.gid??e?.detail?.gid;t&&(console.log("[SDK] profile cache invalidated for",t),this.profileClient.invalidate(t))}catch(e){console.error("[SDK] profile cache invalidation error:",e)}}),this.initialized=!0,console.log("[SDK] init: COMPLETE"),this.eventBus.emit("core:initialized",this.getSystemParams()),t&&this.isAuthenticated()&&(console.log("[SDK] init: calling onAuthReady after init"),t())}catch(e){throw console.error("[SDK] init: ERROR",e),this.captureError(e),e}}captureError(e){try{Oe(e)}catch(e){console.error("[SDK] Sentry capture error:",e)}}showAuthModal(){return new Promise((e,t)=>{new ae({googleEnabled:!0,onGoogleClick:async()=>{try{if(await this.loadOAuthConfig(),!this.getGoogleClientId())return console.warn("[SDK] Google Client ID not configured, falling back to guest"),await this.loginAsGuest(),void e();const{credential:t}=await this.getGoogleIdToken();await this.loginWithGoogle(t),e()}catch(e){console.error("[SDK] Google auth failed:",e),t(e)}},onGuestClick:async()=>{try{await this.loginAsGuest(),e()}catch(e){t(e)}},onClose:()=>{t(new Error("Auth cancelled by user"))}}).show()})}async loginAsGuest(){try{const e=!this.getStoredDeviceId();console.log(e?"[SDK] loginAsGuest: no deviceId found, registering new guest...":"[SDK] loginAsGuest: deviceId found, logging in existing guest...");const t=await this.ensureDeviceId(),s=_[this.systemParams.os||"web"]||3,n=this.systemParams.app||"default",i=this.getStoredToken();console.log("[SDK] loginAsGuest: calling /auth/init",{did:t,os:s,app:n,hasToken:!!i});const o=await this.auth.init({app:n,os:s,did:t,ln:this.getLanguage(),tk:i||void 0}),r=o?.jwt??null;if(!r)throw console.error("[SDK] loginAsGuest: ERROR missing jwt",o),new Error("Guest login failed: missing jwt token");return this.storeToken(r),this.storeAuthType("guest",o.an),this.systemParams.authToken=r,this.eventBus.emit(p.AUTH_SUCCESS,{type:"guest",isNewGuest:e,uid:o.uid,gid:o.gid,anonymous:o.an}),console.log(`[SDK] loginAsGuest: SUCCESS (${e?"registered":"logged in"})`,{uid:o.uid,gid:o.gid,anonymous:o.an}),o}catch(e){throw console.error("[SDK] loginAsGuest: ERROR",e),this.eventBus.emit(p.AUTH_ERROR,{error:e}),this.captureError(e),e}}async signinWithEmail(e){try{console.log("[SDK] signinWithEmail: start",{email:e});const t=_[this.systemParams.os||"web"]||3,s=this.systemParams.app||"default",n=await this.auth.signin({app:s,os:t,email:e,ln:this.getLanguage()});if("rid"in n)return console.log("[SDK] signinWithEmail: code sent, rid =",n.rid),{rid:n.rid};throw new Error("Unexpected response from signin")}catch(e){throw console.error("[SDK] signinWithEmail: ERROR",e),this.captureError(e),e}}async confirmCode(e,t){try{console.log("[SDK] confirmCode: start",{rid:e,code:t});const s=await this.auth.confirmCode({rid:e,code:t}),n=s?.jwt??null;if(!n)throw new Error("Code confirmation failed: missing jwt token");return this.storeToken(n),this.storeAuthType("email",s.an),this.systemParams.authToken=n,this.eventBus.emit(p.AUTH_SUCCESS,{type:"email",uid:s.uid,gid:s.gid,anonymous:s.an}),console.log("[SDK] confirmCode: SUCCESS",{uid:s.uid,gid:s.gid}),s}catch(e){throw console.error("[SDK] confirmCode: ERROR",e),this.captureError(e),e}}async signinWithProvider(e,t){try{console.log("[SDK] signinWithProvider: start",{provider:e});const s=_[this.systemParams.os||"web"]||3,n=this.systemParams.app||"default",i=await this.auth.signin({app:n,os:s,ln:this.getLanguage(),et:t,pr:e});if("rid"in i)throw new Error("Unexpected response: got rid instead of auth response");const o=i?.jwt??null;if(!o)throw new Error("Provider signin failed: missing jwt token");return this.storeToken(o),this.storeAuthType(e,i.an),this.systemParams.authToken=o,this.eventBus.emit(p.AUTH_SUCCESS,{type:e,uid:i.uid,gid:i.gid,anonymous:i.an}),console.log("[SDK] signinWithProvider: SUCCESS",{uid:i.uid,gid:i.gid}),i}catch(e){throw console.error("[SDK] signinWithProvider: ERROR",e),this.captureError(e),e}}async logout(){try{console.log("[SDK] logout: start"),this.clearToken(),this.clearAuthType(),this.systemParams.authToken=void 0,console.log("[SDK] logout: COMPLETE")}catch(e){throw console.error("[SDK] logout: ERROR",e),this.captureError(e),e}}setSystemParams(e){this.systemParams={...this.systemParams,...e}}getSystemParams(){const{isCordova:e,os:t,...s}=this.systemParams;return s}on(e,t){this.eventBus.on(e,t)}once(e,t){this.eventBus.once(e,t)}off(e,t){this.eventBus.off(e,t)}emit(e,...t){this.eventBus.emit(e,...t)}detectEnvironment(){const e=typeof navigator<"u"?navigator.userAgent:"",t=typeof window<"u"&&typeof window.cordova<"u";this.systemParams.os=this.detectOS(e),this.systemParams.isCordova=t}detectOS(e){return/android/i.test(e)?"android":/iPad|iPhone|iPod/i.test(e)?"ios":/Win/i.test(e)?"windows":/Mac/i.test(e)?"macos":/Linux/i.test(e)?"linux":"web"}getLanguage(){return typeof navigator<"u"&&navigator.language?navigator.language.split("-")[0]:"en"}async ensureDeviceId(){const e=this.getStoredDeviceId();if(e)return e;const t=await this.tryGetCordovaDeviceId();if(t)return this.storeDeviceId(t),t;const s=this.generateGuid();return this.storeDeviceId(s),s}getStoredDeviceId(){try{return localStorage.getItem("coreSDK_deviceId")}catch(e){return console.error("[SDK] getStoredDeviceId error:",e),null}}storeDeviceId(e){try{localStorage.setItem("coreSDK_deviceId",e)}catch(e){console.error("[SDK] storeDeviceId error:",e)}}getStoredToken(){try{return localStorage.getItem("coreSDK_token")}catch(e){return console.error("[SDK] getStoredToken error:",e),null}}storeToken(e){try{localStorage.setItem("coreSDK_token",e)}catch(e){console.error("[SDK] storeToken error:",e)}}clearToken(){try{localStorage.removeItem("coreSDK_token")}catch(e){console.error("[SDK] clearToken error:",e)}}storeAuthType(e,t){try{localStorage.setItem("coreSDK_authType",e),localStorage.setItem("coreSDK_isAnonymous",t?"true":"false")}catch(e){console.error("[SDK] storeAuthType error:",e)}}getStoredAuthType(){try{return{authType:localStorage.getItem("coreSDK_authType"),isAnonymous:"true"===localStorage.getItem("coreSDK_isAnonymous")}}catch(e){return console.error("[SDK] getStoredAuthType error:",e),{authType:null,isAnonymous:!1}}}clearAuthType(){try{localStorage.removeItem("coreSDK_authType"),localStorage.removeItem("coreSDK_isAnonymous")}catch(e){console.error("[SDK] clearAuthType error:",e)}}storeUrl(e,t){try{localStorage.setItem(e,t)}catch(t){console.error(`[SDK] storeUrl(${e}) error:`,t)}}async tryGetCordovaDeviceId(){if(typeof window>"u")return null;const e=window.device;return e?.uuid?String(e.uuid):null}generateGuid(){const e=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return`${e()}${e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}get profile(){return this.profileClient}isAuthenticated(){return!!this.systemParams.authToken}isGuest(){const{authType:e,isAnonymous:t}=this.getStoredAuthType();return"guest"===e||t}getAuthStatus(){const e=this.isAuthenticated(),{authType:t,isAnonymous:s}=this.getStoredAuthType();return{isAuthenticated:e,authType:e?t:null,isAnonymous:e&&s}}async loadOAuthConfig(){if(this.oauthConfig)return this.oauthConfig;try{return console.log("[SDK] loadOAuthConfig: fetching..."),this.oauthConfig=await this.auth.getOAuthConfig(),console.log("[SDK] loadOAuthConfig: success",this.oauthConfig),this.oauthConfig}catch(e){return console.error("[SDK] loadOAuthConfig: ERROR",e),null}}getGoogleClientId(){return this.oauthConfig?.google?.clientId??null}async loginWithGoogle(e){try{console.log("[SDK] loginWithGoogle: start");const t=await this.ensureDeviceId(),s=_[this.systemParams.os||"web"]||3,n=this.systemParams.app||"default",i=await this.auth.googleSignIn(e,{app:n,os:s,did:t,ln:this.getLanguage()}),o=i?.jwt??null;if(!o)throw new Error("Google login failed: missing jwt token");return this.storeToken(o),this.storeAuthType("google",i.an),this.systemParams.authToken=o,this.eventBus.emit(p.AUTH_SUCCESS,{type:"google",uid:i.uid,gid:i.gid,anonymous:i.an}),console.log("[SDK] loginWithGoogle: SUCCESS",{uid:i.uid,gid:i.gid}),i}catch(e){throw console.error("[SDK] loginWithGoogle: ERROR",e),this.eventBus.emit(p.AUTH_ERROR,{error:e}),this.captureError(e),e}}async getGoogleIdToken(e){try{console.log("[SDK] getGoogleIdToken: start"),await this.loadOAuthConfig();const t=this.getGoogleClientId();if(!t)throw new Error("Google Client ID not configured. Check OAuth config.");await D.loadScript();const s=await D.requestToken(t,e);return console.log("[SDK] getGoogleIdToken: SUCCESS"),s}catch(e){throw console.error("[SDK] getGoogleIdToken: ERROR",e),this.captureError(e),e}}async initConfigs(e){try{console.log("[SDK] initConfigs:",e);const t=await this.configs.init({v:e.version,scopes:e.scopes,keys:e.keys,values:e.values,segment:e.segment,ab:this.configState.ab,abG:this.configState.abG,abExp:this.configState.abExp});return this.configState={segment:t.segment,ab:t.ab,abG:t.abG,abExp:t.abExp,configs:t.configs||{}},console.log("[SDK] initConfigs: SUCCESS",{segment:t.segment,ab:t.ab,abG:t.abG}),new W(t,this.configState.configs)}catch(e){throw console.error("[SDK] initConfigs: ERROR",e),this.captureError(e),e}}async fetchConfigs(e){try{console.log("[SDK] fetchConfigs:",e);const t=await this.configs.fetch({v:e.version,segment:this.configState.segment,scopes:e.scopes,keys:e.keys,values:e.values});return t.configs&&(this.configState.configs={...this.configState.configs,...t.configs}),console.log("[SDK] fetchConfigs: SUCCESS",{scopes:Object.keys(t.configs||{})}),new W(t,this.configState.configs)}catch(e){throw console.error("[SDK] fetchConfigs: ERROR",e),this.captureError(e),e}}getConfig(e,t){return this.configState.configs[e]?.[t]}getConfigsByScope(e){return this.configState.configs[e]}getSegment(){return this.configState.segment}getABTest(){return{ab:this.configState.ab,abG:this.configState.abG,abExp:this.configState.abExp}}}const We=f.getInstance(),b=[{name:"core",description:"Core SDK initialization",methods:[{name:"init",description:"Initialize SDK with config",enabled:!0,example:'await coreSDK.init({\n                  app: "test-frontend",\n                  configUrl: "http://localhost:3000",\n                  authUrl: "http://localhost:3001",\n                  profileUrl: "http://localhost:3002",\n                  version: "1.0.0",\n                    skipAuth: false \n                }, () => {\n                  console.log("SDK initialized and authenticated!");\n                });'},{name:"getSystemParams",description:"Get current system parameters",enabled:!0,example:"const params = coreSDK.getSystemParams();\n// { app, version, deviceId, authToken, ... }"},{name:"isAuthenticated",description:"Check if user is authenticated",enabled:!0,example:"const isAuth = coreSDK.isAuthenticated();"},{name:"setSystemParams",description:"Set system parameters (app, version, etc.)",enabled:!0,example:'coreSDK.setSystemParams({ app: "my-game", version: "2.0.0" });'},{name:"isGuest",description:"Check if current user is a guest",enabled:!0,example:"const isGuest = coreSDK.isGuest();"},{name:"on",description:"Subscribe to SDK events",enabled:!0,example:'coreSDK.on("auth:login", (user) => console.log("Logged in:", user));\ncoreSDK.on("auth:logout", () => console.log("Logged out"));\ncoreSDK.on("profile:updated", (profile) => console.log("Profile updated"));'},{name:"once",description:"Subscribe to SDK event (fires once)",enabled:!0,example:'coreSDK.once("core:initialized", () => console.log("SDK ready"));'},{name:"off",description:"Unsubscribe from SDK events",enabled:!0,example:'const handler = (user) => console.log(user);\ncoreSDK.on("auth:login", handler);\ncoreSDK.off("auth:login", handler);'}]},{name:"auth",description:"Authentication methods",methods:[{name:"loginAsGuest",description:"Login as guest user",enabled:!0,example:"await coreSDK.loginAsGuest();"},{name:"loginWithGoogle",description:"Login with Google OAuth",enabled:!0,example:"const { credential } = await coreSDK.getGoogleIdToken();\nawait coreSDK.loginWithGoogle(credential);"},{name:"getGoogleIdToken",description:"Get Google ID Token for custom Sign-In UI",enabled:!0,example:"const { credential, select_by } = await coreSDK.getGoogleIdToken();"},{name:"logout",description:"Logout current user",enabled:!0,example:"await coreSDK.logout();"},{name:"getAuthStatus",description:"Get authentication status and type",enabled:!0,example:'const status = coreSDK.getAuthStatus();\n// { isAuthenticated: true, authType: "google", isAnonymous: false }'},{name:"signinWithEmail",description:"Sign in with email (sends verification code)",enabled:!0,example:'await coreSDK.signinWithEmail("user@example.com");\n// Sends verification code to email'},{name:"confirmCode",description:"Confirm verification code from email",enabled:!0,example:'const result = await coreSDK.confirmCode("123456");\n// { accessToken, refreshToken, user }'},{name:"signinWithProvider",description:"Sign in with external provider",enabled:!0,example:'await coreSDK.signinWithProvider("google", { idToken: "..." });'}]},{name:"configs",description:"Configs API (segments, A/B tests, filters)",methods:[{name:"sdk.initConfigs",description:"Initialize configs with segment and A/B test assignment",enabled:!0,example:'const response = await coreSDK.initConfigs({\n  version: "1.0.0",\n  scopes: ["gameplay", "ui"],\n  values: { isPremium: false, country: "US", level: 10 }\n});\n// Returns: { segment, ab, abG, abExp, configs }'},{name:"sdk.fetchConfigs",description:"Fetch configs by scopes with MongoDB-style filters",enabled:!0,example:'const response = await coreSDK.fetchConfigs({\n  version: "1.0.0",\n  scopes: ["monetization", "gameplay"],\n  values: { isPremium: true, level: 50 }\n});\n// Filters: $eq, $ne, $gt, $gte, $lt, $lte, $in, $nin'},{name:"sdk.getConfig",description:"Get specific config value by scope and key",enabled:!0,example:'const maxLives = coreSDK.getConfig("gameplay", "maxLives");'},{name:"sdk.getConfigsByScope",description:"Get all configs in a scope",enabled:!0,example:'const uiConfigs = coreSDK.getConfigsByScope("ui");'},{name:"sdk.getConfigState",description:"Get current segment and A/B test state",enabled:!0,example:'// Get user segment\nconst segment = coreSDK.getSegment(); // "premium" | undefined\n\n// Get A/B test assignment\nconst { ab, abG, abExp } = coreSDK.getABTest();\n// ab = test key, abG = group key, abExp = expiration timestamp'},{name:"configResult.get",description:"Get config value by path (supports nested access)",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });\n\n// Simple path\nconfigs.get('gameplay.maxLives');           // 3\n\n// Array access\nconfigs.get('gameplay.items[0].name');      // \"sword\"\n\n// Nested object\nconfigs.get('gameplay.rewards.daily');      // { coins: 100 }\n\n// Typed result\nconfigs.get<number>('gameplay.maxLives');   // 3 (typed)"},{name:"configResult.has",description:"Check if config path exists",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });\n\nconfigs.has('gameplay.maxLives');    // true\nconfigs.has('gameplay.notExists');   // false"},{name:"configResult.keys",description:"Get all config keys in flat format",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });\n\nconfigs.keys();\n// ['gameplay.maxLives', 'gameplay.items', 'ui.theme', 'ui.colors']"},{name:"configResult.values",description:"Get all config values",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });\n\nconfigs.values();\n// [3, [...], 'dark', { primary: '#000' }]"},{name:"configResult.getScope",description:"Get all configs for a specific scope",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });\n\nconfigs.getScope('gameplay');\n// { maxLives: 3, items: [...], rewards: { daily: { coins: 100 } } }"},{name:"configResult.getAll",description:"Get all configs grouped by scope",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay', 'ui'] });\n\nconfigs.getAll();\n// { gameplay: { maxLives: 3, ... }, ui: { theme: 'dark', ... } }"},{name:"configResult.getMeta",description:"Get segment and A/B test metadata",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });\n\nconfigs.getMeta();\n// { segment: 'premium', ab: 'test_a', abG: 'control', abExp: 1234567890 }"},{name:"configResult.raw",description:"Get raw ConfigResponse from server",enabled:!0,example:"const configs = await coreSDK.initConfigs({ version: '1.0.0', scopes: ['gameplay'] });\n\nconfigs.raw();\n// Original ConfigResponse: { segment, ab, abG, abExp, configs: {...} }"}]},{name:"profile",description:"User profile methods",methods:[{name:"profile.getProfile",description:"Get full user profile",enabled:!0,example:"const profile = await coreSDK.profile.getProfile();\n// { id, version, base: { name, avatar }, scopes: { game: {...} } }"},{name:"profile.updateProfile",description:"Update profile (partial merge)",enabled:!0,example:'await coreSDK.profile.updateProfile({\n  base: { name: "NewName" },\n  scopes: { game: { level: 10 } }\n});'},{name:"profile.getProfileField",description:"Get field value by dot-notation path",enabled:!0,example:'const level = await coreSDK.profile.getProfileField("scopes.game.level");'},{name:"profile.setProfileField",description:"Set field value by dot-notation path",enabled:!0,example:'await coreSDK.profile.setProfileField("scopes.game.coins", 1000);'},{name:"profile.mergeProfileScope",description:"Merge data into specific scope",enabled:!0,example:'await coreSDK.profile.mergeProfileScope("game", { xp: 500, level: 10 });'},{name:"profile.invalidate",description:"Invalidate profile cache for specific player",enabled:!0,example:'coreSDK.profile.invalidate("player-id");'},{name:"profile.invalidateAll",description:"Invalidate all profile cache",enabled:!0,example:"coreSDK.profile.invalidateAll();"},{name:"profile.resetMyProfileId",description:"Reset current player profile ID (for logout)",enabled:!0,example:"coreSDK.profile.resetMyProfileId();"}]},{name:"kv",description:"Key-Value storage for player data",methods:[{name:"kv.get",description:"Get value by key",enabled:!0,example:'const { value } = await coreSDK.playerKv.get("settings");'},{name:"kv.set",description:"Set value by key",enabled:!0,example:'await coreSDK.playerKv.set("settings", JSON.stringify({ theme: "dark" }));'},{name:"kv.delete",description:"Delete value by key",enabled:!0,example:'await coreSDK.playerKv.delete("settings");'},{name:"kv.exists",description:"Check if key exists",enabled:!0,example:'const { exists } = await coreSDK.playerKv.exists("settings");'},{name:"kv.getMany",description:"Get multiple values by keys",enabled:!0,example:'const values = await coreSDK.playerKv.getMany(["key1", "key2"]);'},{name:"kv.list",description:"List all keys",enabled:!0,example:"const { keys } = await coreSDK.playerKv.list();"},{name:"kv.setMany",description:"Set multiple key-value pairs",enabled:!0,example:'await coreSDK.playerKv.setMany([\n  { key: "settings", value: JSON.stringify({ theme: "dark" }) },\n  { key: "progress", value: JSON.stringify({ level: 5 }) }\n]);'},{name:"kv.deleteMany",description:"Delete multiple keys",enabled:!0,example:'await coreSDK.playerKv.deleteMany(["key1", "key2", "key3"]);'}]},{name:"health",description:"Health check API",methods:[{name:"health.check",description:"Quick health check",enabled:!0,example:'const health = await coreSDK.health.check();\n// { status: "ok", timestamp: 1234567890 }'},{name:"health.version",description:"Get service version",enabled:!0,example:"const { version, name } = await coreSDK.health.version();"},{name:"health.getVersion",description:"Get service version (alias)",enabled:!0,example:"const version = await coreSDK.health.getVersion();"},{name:"health.detailed",description:"Get detailed health check with dependencies",enabled:!0,example:'const detailed = await coreSDK.health.detailed();\n// { status: "ok", database: "ok", redis: "ok", ... }'}]},{name:"gamestate",description:"Game state persistence",methods:[{name:"gamestate.get",description:"Load current game state",enabled:!0,example:"const { meta } = await coreSDK.gamestate.get();\n// meta contains saved game progress"},{name:"gamestate.update",description:"Update game state (deep merge on backend)",enabled:!0,example:"await coreSDK.gamestate.update({\n  level: 5,\n  coins: 120,\n  settings: { sound: false }\n});"}]},{name:"abTests",description:"A/B Tests Admin API (disabled)",methods:[{name:"abTests.getAll",description:"Get all A/B tests",enabled:!1,example:"const tests = await coreSDK.abTests.getAll();"},{name:"abTests.getActive",description:"Get all active A/B tests",enabled:!1,example:"const activeTests = await coreSDK.abTests.getActive();"},{name:"abTests.getById",description:"Get A/B test by ID",enabled:!1,example:'const test = await coreSDK.abTests.getById("test-id");'},{name:"abTests.getVariant",description:"Get A/B test variant for current user",enabled:!1,example:'const variant = await coreSDK.abTests.getVariant("test-key");'},{name:"abTests.create",description:"Create A/B test",enabled:!1,example:'await coreSDK.abTests.create({ key: "test", name: "Test", groups: [...] });'},{name:"abTests.update",description:"Update A/B test (full replace)",enabled:!1,example:'await coreSDK.abTests.update("test-id", { name: "Updated Test", ... });'},{name:"abTests.patch",description:"Partially update A/B test",enabled:!1,example:'await coreSDK.abTests.patch("test-id", { name: "New Name" });'},{name:"abTests.delete",description:"Delete A/B test",enabled:!1,example:'await coreSDK.abTests.delete("test-id");'}]},{name:"remoteConfigs",description:"Remote Configs Admin API (disabled)",methods:[{name:"remoteConfigs.getAll",description:"Get all remote configs",enabled:!1,example:"const configs = await coreSDK.remoteConfigs.getAll();"},{name:"remoteConfigs.getById",description:"Get remote config by ID",enabled:!1,example:'const config = await coreSDK.remoteConfigs.getById("config-id");'},{name:"remoteConfigs.create",description:"Create remote config",enabled:!1,example:'await coreSDK.remoteConfigs.create({ key: "ui", scope: "ui", data: {...} });'},{name:"remoteConfigs.update",description:"Update remote config",enabled:!1,example:'await coreSDK.remoteConfigs.update("config-id", { data: {...} });'},{name:"remoteConfigs.delete",description:"Delete remote config",enabled:!1,example:'await coreSDK.remoteConfigs.delete("config-id");'},{name:"remoteConfigs.refresh",description:"Refresh remote configs cache",enabled:!1,example:"await coreSDK.remoteConfigs.refresh();"}]},{name:"segments",description:"Segments Admin API (disabled)",methods:[{name:"segments.getAll",description:"Get all segments",enabled:!1,example:"const segments = await coreSDK.segments.getAll();"},{name:"segments.getById",description:"Get segment by ID",enabled:!1,example:'const segment = await coreSDK.segments.getById("segment-id");'},{name:"segments.getUserSegments",description:"Get segments for current user",enabled:!1,example:"const userSegments = await coreSDK.segments.getUserSegments();"},{name:"segments.create",description:"Create segment",enabled:!1,example:'await coreSDK.segments.create({ key: "vip", name: "VIP", filters: {...} });'},{name:"segments.update",description:"Update segment",enabled:!1,example:'await coreSDK.segments.update("segment-id", { name: "Premium VIP" });'},{name:"segments.delete",description:"Delete segment",enabled:!1,example:'await coreSDK.segments.delete("segment-id");'}]},{name:"users",description:"Users Admin API (disabled)",methods:[{name:"users.getAll",description:"Get all users",enabled:!1,example:"const users = await coreSDK.users.getAll();"},{name:"users.getById",description:"Get user by ID",enabled:!1,example:'const user = await coreSDK.users.getById("user-id");'},{name:"users.search",description:"Search users by query",enabled:!1,example:'const results = await coreSDK.users.search({ email: "user@example.com" });'},{name:"users.create",description:"Create user",enabled:!1,example:'await coreSDK.users.create({ email: "user@example.com", name: "User" });'},{name:"users.update",description:"Update user",enabled:!1,example:'await coreSDK.users.update("user-id", { name: "New Name" });'},{name:"users.delete",description:"Delete user",enabled:!1,example:'await coreSDK.users.delete("user-id");'}]},{name:"eventsApi",description:"Events Analytics API (disabled)",methods:[{name:"events.getAll",description:"Get all events",enabled:!1,example:"const events = await coreSDK.events.getAll();"},{name:"events.send",description:"Send analytics event",enabled:!1,example:'await coreSDK.events.send({ name: "level_complete", data: { level: 5 } });'}]}];function Ve(e){for(const t of b)for(const s of t.methods)if(s.name===e)return s.enabled;return!1}function Ye(e){return!!b.find(t=>t.name===e)}function Qe(){const e=[];for(const t of b)if(t)for(const s of t.methods)s.enabled&&e.push(s.name);return e}function Xe(e){return b.find(t=>t.name===e)?.methods??[]}function Ze(e,t){for(const s of b)for(const n of s.methods)if(n.name===e)return void(n.enabled=t)}typeof window<"u"&&(window.coreSDK=We);export{Re as AbTestsApiClient,re as ApiClient,qe as AuthApiClient,ae as AuthModal,W as ConfigResult,Le as ConfigsApiClient,f as CoreSDK,oe as EventBus,D as GoogleAuthHelper,Me as HealthApiClient,Fe as PlayerKVApiClient,$e as RemoteConfigsApiClient,p as SDK_EVENTS,b as SDK_METHODS,U as SDK_VERSION,G as SUPPORTED_VERSIONS,Be as SegmentsApiClient,Ne as UsersApiClient,We as coreSDK,Qe as getEnabledMethods,Xe as getMethodsByCategory,Ye as isCategoryEnabled,Ve as isMethodEnabled,ze as isVersionSupported,u as sdkConfig,$ as setAuthUrl,R as setBaseUrl,Ze as setMethodEnabled,je as validateVersion};