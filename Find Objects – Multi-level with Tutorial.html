<!DOCTYPE html>
<!-- saved from url=(0053)https://stage.artintgames.com/game/testpic/index.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Find Objects ‚Äì Multi-level with Tutorial</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  :root{
    --safeT: max(10px, env(safe-area-inset-top));
    --safeR: max(10px, env(safe-area-inset-right));
    --safeB: max(10px, env(safe-area-inset-bottom));
    --safeL: max(10px, env(safe-area-inset-left));
    --uiGap: 10px;
  }

  html, body { width:100%; height:100%; }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #1f1f2a;
    color: #fff;
    min-height: 100dvh;
    overflow: hidden;
  }

  /* Dim active screen when auth overlay is visible */
  body.login-active .screen.active{
    opacity: 0.4;
    transform: translateZ(0);
    pointer-events: none;
  }

  .screen {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    min-height: 100dvh;
    display: none;
    overflow: hidden;
  }
  .screen.active { display: block; }

  /* ---------- SPLASH SCREEN ---------- */
  #splashScreen { min-height: 100dvh; }

  .splash-wrapper {
    width: 100%;
    height: 100%;
    min-height: 100dvh;
    padding: var(--safeT) var(--safeR) var(--safeB) var(--safeL);
    border-radius: 0;
    background:
      radial-gradient(circle at 10% 0%, #ffdd8a, transparent 60%),
      linear-gradient(180deg, #3a334a, #1f1f2a);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    text-align: center;
  }

  .splash-title {
    font-size: 24px;
    font-weight: 800;
    letter-spacing: 0.03em;
    margin-top: 8px;
  }

  .splash-subtitle {
    font-size: 13px;
    opacity: 0.9;
    max-width: 280px;
  }

  .splash-top-block {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    margin-top: 40px;
  }

  .splash-loader {
    margin-bottom: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .splash-spinner {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.2);
    border-top-color: #ffcc66;
    animation: spin 1s linear infinite;
  }

  .splash-loader-text {
    font-size: 12px;
    opacity: 0.85;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* ---------- MAIN MENU / LEVEL SCREEN ---------- */
  .menu-wrapper {
    width: 100%;
    height: 100%;
    min-height: 100dvh;
    padding: var(--safeT) var(--safeR) var(--safeB) var(--safeL);
    border-radius: 0;
    background:
      radial-gradient(circle at 10% 0%, #ffc977, transparent 55%),
      linear-gradient(180deg, #3a334a, #1f1f2a);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    gap: 14px;
  }

  .menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }

  .menu-header-title {
    font-size: 18px;
    font-weight: 700;
    opacity: 0.9;
  }

  .menu-settings-btn {
    border: none;
    background: rgba(0,0,0,0.55);
    color: #fff;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    box-shadow: 0 0 6px rgba(0,0,0,0.6);
  }
  .menu-settings-btn:active { transform: scale(0.95); }

  .menu-content {
    margin-top: 12px;
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 12px;
  }

  .menu-logo {
    align-self: center;
    position: relative;
    margin-top: 60px;
    padding: 12px 26px;
    border-radius: 999px;
    background:
      radial-gradient(circle at 15% 0%, rgba(255,255,255,0.45), transparent 60%),
      linear-gradient(135deg, #ffdf9c, #ffb25e);
    box-shadow:
      0 8px 18px rgba(0,0,0,0.6),
      0 0 0 2px rgba(255,255,255,0.35);
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .menu-logo::after {
    content: "";
    position: absolute;
    inset: 2px 6px;
    border-radius: 999px;
    background: linear-gradient(180deg, rgba(255,255,255,0.35), transparent 60%);
    opacity: 0.85;
    pointer-events: none;
  }

  .menu-logo-text {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1.1;
    text-shadow: 0 2px 4px rgba(0,0,0,0.35);
  }

  .menu-logo-title-top {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
  }

  .menu-logo-title-bottom {
    margin-top: 2px;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: 0.06em;
  }

  .menu-level-info {
    padding: 14px 14px;
    border-radius: 18px;
    background:
      radial-gradient(circle at 0% 0%, rgba(255,255,255,0.32), transparent 60%),
      linear-gradient(180deg, #514067, #2b2538);
    box-shadow: 0 8px 18px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .menu-level-label {
    font-size: 14px;
    font-weight: 700;
    opacity: 0.95;
  }

  .menu-level-title {
    font-size: 18px;
    font-weight: 800;
  }

  .menu-level-desc {
    font-size: 13px;
    opacity: 0.9;
  }

  /* Big scoreboard section button */
  .menu-section-btn{
    width: 100%;
    border: none;
    cursor: pointer;
    padding: 14px 14px;
    border-radius: 18px;
    background:
      radial-gradient(circle at 15% 0%, rgba(255,255,255,0.35), transparent 60%),
      linear-gradient(135deg, #ffe9c4, #ffffff, #ffd08a);
    box-shadow: 0 10px 18px rgba(0,0,0,0.55);
    color: #2a1d12;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }
  .menu-section-btn:active{ transform: translateY(1px); box-shadow: 0 6px 14px rgba(0,0,0,0.6); }
  .menu-section-left{
    display: flex;
    flex-direction: column;
    gap: 2px;
    text-align: left;
  }
  .menu-section-title{
    font-size: 16px;
    font-weight: 900;
    letter-spacing: 0.02em;
  }
  .menu-section-sub{
    font-size: 12px;
    font-weight: 700;
    opacity: 0.8;
  }
  .menu-section-right{
    font-size: 18px;
    font-weight: 900;
    opacity: 0.9;
  }

  .play-btn-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  .play-btn {
    padding: 14px 42px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 18px;
    font-weight: 700;
    color: #40301e;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 18px rgba(0,0,0,0.6);
    background: linear-gradient(90deg, #ffe9c4, #ffffff, #ffe1a1);
    background-size: 200% 100%;
    animation: shimmer 2.5s infinite;
  }

  .play-btn:active {
    transform: translateY(1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.7);
  }

  .play-btn.secondary {
    padding: 10px 26px;
    font-size: 14px;
    background: linear-gradient(180deg, #3f314a, #261d33);
    color: #f5e3ff;
    animation: none;
  }

  @keyframes shimmer {
    0%   { background-position: 0% 0; }
    50%  { background-position: 100% 0; }
    100% { background-position: 0% 0; }
  }

  /* ---------- GAME / TUTORIAL WRAPPER ---------- */
  img { -webkit-user-drag: none; user-select: none; }

  .game-wrapper {
    width: 100%;
    height: 100%;
    min-height: 100dvh;
    padding: var(--safeT) var(--safeR) var(--safeB) var(--safeL);
    display: grid;
    grid-template-rows: auto 1fr auto;
    gap: var(--uiGap);
    min-height: 0;
  }

  .tutorial-wrapper{
    grid-template-rows: auto 1fr auto auto;
  }

  .hud {
    position: relative;
    border-radius: 18px;
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    overflow: hidden;
    background: linear-gradient(180deg, #c97b30, #9a4b1e);
    box-shadow: 0 4px 10px rgba(0,0,0,0.45);
  }

  .hud::before {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: 14px;
    z-index: -1;
    background:
      radial-gradient(circle at 0% 0%, rgba(255,255,255,0.36), transparent 55%),
      linear-gradient(180deg, #f8d89e, #f0b35a);
  }

  .hud > * { position: relative; z-index: 1; }

  .hud-title-row {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .hud-title-row span.title-text {
    font-weight: 700;
    font-size: 16px;
  }

  .hud-header {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    font-size: 13px;
  }

  .hud-progress { opacity: 0.9; }
  .hud-score { text-align: center; font-weight: 700; }
  .hud-lives { text-align: right; }

  .hud-lives .hearts {
    font-size: 18px;
    color: #ff4a4a;
    text-shadow: 0 0 4px rgba(0,0,0,0.4);
  }

  .game {
    position: relative;
    height: 100%;
    min-height: 0;
    width: auto;
    max-width: 100%;
    max-height: 100%;
    overflow: hidden;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    background: #000;
    margin: 0 auto;
  }

  .game-bg {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  .game-top-buttons {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 20;
  }

  .menu-button,
  .hint-button {
    position: relative;
    border: none;
    background: rgba(0,0,0,0.55);
    color: #fff;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    box-shadow: 0 0 6px rgba(0,0,0,0.6);
  }

  .menu-button:active,
  .hint-button:active { transform: scale(0.95); }

  .hint-button { font-size: 0; }
  .hint-button::before {
    content: "üí°";
    font-size: 18px;
    line-height: 1;
    display: block;
  }
  .hint-button::after {
    content: attr(data-hints);
    position: absolute;
    right: 5px;
    bottom: 4px;
    font-size: 11px;
  }
  .hint-button:disabled { opacity: 0.4; cursor: default; }

  /* Tutorial skip button (top-left of tutorial game field) */
  .tutorial-skip-btn{
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 25;
    border: none;
    background: rgba(0,0,0,0.55);
    color: #fff;
    height: 38px;
    padding: 0 14px;
    border-radius: 999px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 800;
    letter-spacing: 0.02em;
    box-shadow: 0 0 6px rgba(0,0,0,0.6);
  }
  .tutorial-skip-btn:active{ transform: scale(0.97); }

  .item,
  .t-item {
    position: absolute;
    cursor: default;
    user-select: none;
    transition: transform 0.15s ease, opacity 0.15s ease, box-shadow 0.15s ease;
    z-index: 5;
    will-change: transform, opacity;
  }

  .item:active,
  .t-item:active { transform: scale(0.9); }

  @keyframes hint-wiggle {
    0%   { transform: translate(0, 0) scale(1); }
    20%  { transform: translate(-1px, 0) scale(1.02); }
    40%  { transform: translate(1px, 0) scale(1.02); }
    60%  { transform: translate(-1px, 0) scale(1.02); }
    80%  { transform: translate(1px, 0) scale(1.02); }
    100% { transform: translate(0, 0) scale(1); }
  }

  .item.hint-highlight,
  .t-item.hint-highlight {
    box-shadow: 0 0 12px 3px rgba(255, 240, 170, 0.9);
    border-radius: 8px;
    animation: hint-wiggle 0.6s ease-in-out 2;
  }

  .t-item.tutorial-focus {
    z-index: 50;
    box-shadow: 0 0 16px 4px rgba(255, 255, 200, 0.95);
    transform: scale(1.05);
  }

  .miss-marker {
    position: absolute;
    width: 32px;
    height: 32px;
    pointer-events: none;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.7);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .miss-marker::before,
  .miss-marker::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 3px;
    background: rgba(255,80,80,0.95);
    box-shadow: 0 0 6px rgba(255,0,0,0.8);
    transform-origin: center;
  }

  .miss-marker::before { transform: translate(-50%, -50%) rotate(45deg); }
  .miss-marker::after  { transform: translate(-50%, -50%) rotate(-45deg); }

  .miss-marker.visible {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(0,0,0,0.25), rgba(0,0,0,0.8));
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
    text-align: center;
    padding: 16px;
    z-index: 40;
    opacity: 0;
    transition: opacity 0.25s ease;
    will-change: opacity;
  }

  .overlay.visible {
    display: flex;
    opacity: 1;
  }

  @keyframes overlay-pop {
    0%   { transform: scale(0.85); opacity: 0; }
    60%  { transform: scale(1.02); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes overlay-drop {
    0%   { transform: translateY(-12px); opacity: 0; }
    60%  { transform: translateY(2px);  opacity: 1; }
    100% { transform: translateY(0);    opacity: 1; }
  }

  .overlay.win { animation: overlay-pop 0.45s ease-out forwards; }
  .overlay.lose { animation: overlay-drop 0.4s ease-out forwards; }

  .overlay-title { font-size: 22px; font-weight: 800; }
  .overlay-text  { font-size: 14px; opacity: 0.9; }

  .btn {
    padding: 8px 16px;
    border-radius: 999px;
    border: none;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: #ffb347;
    color: #40210f;
    box-shadow: 0 2px 0 rgba(0,0,0,0.25);
  }

  .btn:active {
    transform: translateY(1px);
    box-shadow: 0 1px 0 rgba(0,0,0,0.35);
  }

  .carousel {
    position: relative;
    padding: 6px 8px;
    border-radius: 18px;
    display: flex;
    gap: 8px;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    height: clamp(90px, 16vh, 140px);
    align-items: center;
    background: linear-gradient(180deg, #c97b30, #8b421d);
    box-shadow: 0 -4px 10px rgba(0,0,0,0.55);
    min-height: 0;
  }

  .carousel::before {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: 14px;
    z-index: -1;
    background:
      radial-gradient(circle at 15% 0%, rgba(255,255,255,0.18), transparent 55%),
      linear-gradient(180deg, #f4c77d, #e49b47);
  }

  .carousel::-webkit-scrollbar { height: 5px; }
  .carousel::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.35);
    border-radius: 3px;
  }

  .carousel-item {
    flex: 0 0 auto;
    text-align: center;
    font-size: 11px;
    opacity: 0.95;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 1;
    padding: 4px 10px 6px;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.02));
    box-shadow: 0 1px 2px rgba(0,0,0,0.35);
  }

  .carousel-icon {
    width: 44px;
    height: 44px;
    object-fit: contain;
    display: block;
    margin-bottom: 2px;
  }

  .carousel-label { white-space: nowrap; }

  .carousel-item.found {
    opacity: 0.35;
    filter: grayscale(0.9);
    text-decoration: line-through;
  }

  .tutorial-text {
    margin-top: 0;
    font-size: 12px;
    opacity: 0.9;
    line-height: 1.35;
    max-height: min(18vh, 140px);
    overflow: auto;
    padding-right: 4px;
  }
  .tutorial-text p + p { margin-top: 2px; }

  .tutorial-guide-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center;
    align-items: flex-end;
    padding: 16px;
    z-index: 30;
    pointer-events: none;
  }

  .tutorial-guide-overlay.visible { display: flex; }

  .tutorial-guide-box {
    background: rgba(0,0,0,0.9);
    border-radius: 14px;
    padding: 10px 14px;
    font-size: 13px;
    text-align: center;
    max-width: 260px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.18);
  }

  .tutorial-guide-title {
    font-weight: 700;
    margin-bottom: 4px;
    font-size: 14px;
  }

  /* SETTINGS OVERLAY */
  .settings-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 100;
  }

  .settings-overlay.visible { display: flex; }

  .settings-panel {
    position: relative;
    background: rgba(0,0,0,0.95);
    border-radius: 14px;
    padding: 14px 16px 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-size: 12px;
    min-width: 230px;
  }

  .settings-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
  }

  .settings-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }

  .settings-label { opacity: 0.9; }

  .settings-toggle {
    padding: 4px 10px;
    border-radius: 999px;
    border: none;
    font-size: 12px;
    cursor: pointer;
    background: #333;
    color: #fff;
  }

  .settings-toggle.on { background: #4caf50; }
  .settings-toggle.off { background: #777; }

  .settings-btn-restart { margin-top: 4px; padding: 6px 10px; font-size: 12px; }
  .settings-btn-exit {
    margin-top: 4px;
    padding: 6px 10px;
    font-size: 12px;
    background: #ff7b7b;
    color: #3b1414;
  }

  .settings-close {
    position: absolute;
    top: 6px;
    right: 6px;
    border: none;
    background: transparent;
    color: #fff;
    font-size: 14px;
    cursor: pointer;
  }

  .settings-close:active { transform: scale(0.95); }

  .settings-links {
    margin-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 11px;
    opacity: 0.9;
  }

  .settings-link-item { cursor: default; }

  /* ---------- AUTH SECTION ---------- */
  .settings-auth {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }

  .settings-status {
    font-size: 12px;
    color: #aaa;
    text-align: center;
    padding: 4px 0;
  }

  .settings-status.logged-in {
    color: #4caf50;
  }

  .settings-btn-auth {
    padding: 10px 16px;
    font-size: 13px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.1s, opacity 0.2s;
  }

  .settings-btn-auth:active {
    transform: scale(0.98);
  }

  .settings-btn-auth:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  #loginGuestButton {
    background: linear-gradient(135deg, #555, #333);
    color: #fff;
  }

  #loginGoogleButton {
    background: #fff;
    color: #333;
    border: 1px solid #ddd;
  }

  .settings-btn-logout {
    background: #ff5252;
    color: #fff;
  }

  /* ---------- PLAYER AVATAR & NAME ---------- */
  .player-info {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .player-avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ffd27f, #ff8e4c);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
    color: #3b2312;
    box-shadow: 0 0 0 2px rgba(0,0,0,0.25);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  .player-name { font-size: 13px; font-weight: 600; }

  .game-player {
    position: absolute;
    top: 10px;
    left: 12px;
    z-index: 25;
  }

  /* ---------- LOGIN MODAL ---------- */
  .login-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 200;
  }

  .login-overlay.visible { display: flex; }

  .login-dialog {
    background: #181320;
    border-radius: 18px;
    padding: 18px 20px 16px;
    width: min(90vw, 360px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .login-title { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
  .login-subtitle { font-size: 12px; opacity: 0.85; margin-bottom: 6px; }

  .login-avatar-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }

  .login-avatar-large {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ffd27f, #ff8e4c);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 20px;
    color: #3b2312;
    box-shadow: 0 0 0 2px rgba(0,0,0,0.35);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    cursor: pointer;
  }

  .login-player-name { font-size: 14px; font-weight: 600; }

  .login-field {
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 12px;
  }

  .login-field label { opacity: 0.9; }

  .login-field input {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    padding: 6px 8px;
    background: rgba(0,0,0,0.35);
    color: #fff;
    font-size: 13px;
    outline: none;
  }

  .login-field input:focus { border-color: #ffb347; }

  .login-btn { margin-top: 2px; width: 100%; }

  .login-autofill-btn,
  .login-google-btn {
    margin-top: 4px;
    width: 100%;
    font-size: 13px;
  }

  .login-google-btn { background: #ffffff; color: #222; }

  .login-error {
    margin-top: 2px;
    font-size: 11px;
    color: #ff8a8a;
    min-height: 14px;
  }

  .login-switch {
    margin-top: 4px;
    background: none;
    border: none;
    color: #ffb347;
    font-size: 12px;
    text-align: left;
    cursor: pointer;
    align-self: flex-start;
    padding: 0;
  }

  /* ---------- SCORE SCREEN ---------- */
  .score-wrapper .menu-logo { margin-top: 20px; }
  .score-wrapper .menu-level-info { margin-top: 12px; }

  .scoreboard-players {
    margin-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .scoreboard-player-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 8px;
    border-radius: 12px;
    background: rgba(0,0,0,0.25);
    font-size: 12px;
  }

  /* ---- Press feedback for buttons ---- */
  button, .btn, .play-btn, .menu-settings-btn, .menu-button, .hint-button,
  .tutorial-skip-btn, .settings-toggle, .menu-section-btn, .login-switch {
    position: relative;
    transition: transform 120ms ease, filter 120ms ease, box-shadow 120ms ease;
    will-change: transform, filter;
  }

  button::after, .btn::after, .play-btn::after, .menu-settings-btn::after,
  .menu-button::after, .hint-button::after, .tutorial-skip-btn::after,
  .settings-toggle::after, .menu-section-btn::after, .login-switch::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: rgba(255,255,255,0.18);
    opacity: 0;
    transition: opacity 120ms ease;
    pointer-events: none;
  }

  button:active::after, .btn:active::after, .play-btn:active::after,
  .menu-settings-btn:active::after, .menu-button:active::after, .hint-button:active::after,
  .tutorial-skip-btn:active::after, .settings-toggle:active::after, .menu-section-btn:active::after,
  .login-switch:active::after {
    opacity: 1;
  }

  .is-pressed::after { opacity: 1; }
  .is-pressed { transform: translateY(1px) scale(0.98); filter: brightness(1.08) saturate(1.05); }

  .scoreboard-score { font-weight: 700; }

  /* FIX: restore hint counter (press-feedback overwrote .hint-button::after) */
  .hint-button::after{
    content: attr(data-hints);
    position: absolute;
    right: 5px;
    bottom: 4px;
    top: auto;
    left: auto;

    width: auto;
    height: auto;

    background: none;
    border-radius: 0;
    box-shadow: none;
    padding: 0;

    opacity: 0.95;
    font-size: 11px;
    font-weight: 800;
    transition: none;
    pointer-events: none;
  }

  /* =========================
     PATCH: requested UI changes
     ========================= */

  /* GAME HUD: Found/Lives –ø–æ–¥–Ω—è—Ç—ã –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥–æ–ª–æ–≤–∫–∞; –∏–≥—Ä–æ–∫ –ø–æ–¥ Found; Level –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–º–µ–Ω–∏ */
  #gameScreen .hud.game-hud{
    padding: 10px 12px;
  }
  #gameScreen .hud-topbar{
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: start;
    gap: 10px;
  }
  #gameScreen .hud-left-stack,
  #gameScreen .hud-center-stack,
  #gameScreen .hud-right-stack{
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  #gameScreen .hud-center-stack{
    align-items: center;
    text-align: center;
  }
  #gameScreen .hud-center-stack .title-text{
    font-weight: 800;
    font-size: 16px;
  }
  #gameScreen .hud-center-stack .hud-score{
    font-size: 13px;
    font-weight: 700;
    opacity: 0.95;
  }
  #gameScreen .hud-left-stack .hud-progress{
    font-size: 13px;
    font-weight: 700;
    opacity: 0.95;
  }
  #gameScreen .hud-player .player-name{
    font-size: 12px;
    font-weight: 700;
    opacity: 0.95;
  }
  #gameScreen .hud-right-stack{
    align-items: flex-end;
    text-align: right;
  }
  #gameScreen .hud-right-stack .hud-lives-row{
    font-size: 13px;
    font-weight: 700;
  }
  #gameScreen .hud-right-stack .hud-level{
    font-size: 12px;
    font-weight: 800;
    opacity: 0.95;
    letter-spacing: 0.02em;
  }

  /* Buttons in GAME section a bit larger (~10%) */
  #gameScreen .menu-button,
  #gameScreen .hint-button{
    width: 42px;
    height: 42px;
    font-size: 22px;
  }
  #gameScreen .hint-button::before{
    font-size: 20px;
  }
  #gameScreen .hint-button::after{
    right: 6px;
    bottom: 5px;
    font-size: 12px;
  }

  /* Settings buttons larger on ALL screens */
  .menu-settings-btn{
    width: 44px;
    height: 44px;
    font-size: 22px;
  }

  /* Settings overlay panel larger + text bigger (ONLY settings) */
  .settings-panel{
    width: min(92vw, 420px);
    border-radius: 18px;
    padding: 22px 22px 18px;
    min-width: 320px;
    font-size: 15px; /* increased */
    gap: 10px;
  }
  .settings-title{
    font-size: 20px; /* increased */
    font-weight: 700;
    margin-bottom: 2px;
  }
  .settings-label{
    font-size: 15px; /* increased */
  }
  .settings-toggle{
    padding: 8px 16px; /* slightly increased */
    font-size: 15px;   /* increased */
  }
  .settings-close{
    font-size: 22px; /* increased */
    top: 10px;
    right: 12px;
  }
  .settings-btn-restart,
  .settings-btn-exit{
    padding: 10px 14px; /* increased */
    font-size: 15px;    /* increased */
  }
  .settings-links{
    font-size: 13px; /* increased */
    gap: 4px;
  }

  /* EXTRA: even larger text for Settings opened from MAIN MENU */
  .settings-overlay[data-context="menu"] .settings-panel{
    font-size: 17px;
  }
  .settings-overlay[data-context="menu"] .settings-title{
    font-size: 22px;
  }
  .settings-overlay[data-context="menu"] .settings-label{
    font-size: 17px;
  }
  .settings-overlay[data-context="menu"] .settings-toggle{
    font-size: 17px;
    padding: 10px 18px;
  }
  .settings-overlay[data-context="menu"] .settings-links{
    font-size: 14px;
  }

  /* =========================
     ADS (stub) + overlay actions
     ========================= */

  .btn.secondary{
    background: #3f314a;
    color: #f5e3ff;
  }

  .overlay-actions{
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: min(280px, 90%);
    margin-top: 8px;
  }
  .overlay-actions .btn{ width: 100%; }

  .ad-overlay{
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.78);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 500;
    padding: 16px;
  }
  .ad-overlay.visible{ display: flex; }

  .ad-dialog{
    width: min(92vw, 380px);
    background: #15111d;
    border-radius: 18px;
    padding: 16px 16px 14px;
    box-shadow: 0 14px 36px rgba(0,0,0,0.8);
    border: 1px solid rgba(255,255,255,0.12);
  }
  .ad-title{
    font-size: 16px;
    font-weight: 800;
    margin-bottom: 6px;
  }
  .ad-text{
    font-size: 12px;
    opacity: 0.9;
    line-height: 1.35;
    margin-bottom: 12px;
  }
  .ad-actions{
    display: flex;
    gap: 10px;
  }
  .ad-actions .btn{
    flex: 1;
  }

  /* =========================
     SETTINGS redesign (cards/blocks)
     ========================= */

  .settings-panel{
    width: min(92vw, 440px);
    border-radius: 20px;
    padding: 18px 18px 16px;
    background:
      radial-gradient(circle at 20% 0%, rgba(255,255,255,0.12), transparent 55%),
      linear-gradient(180deg, #171225, #0f0b18);
    border: 1px solid rgba(255,255,255,0.14);
    box-shadow: 0 16px 44px rgba(0,0,0,0.85);
    gap: 12px;
    font-size: 14px;
  }

  .settings-title{
    font-size: 20px;
    font-weight: 900;
    letter-spacing: 0.02em;
  }

  .settings-section{
    border-radius: 16px;
    padding: 12px 12px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.10);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .settings-section-title{
    font-size: 12px;
    font-weight: 900;
    opacity: 0.85;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  .settings-row{
    padding: 8px 10px;
    border-radius: 14px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.08);
  }

  .settings-links{
    margin-top: 0;
    gap: 8px;
    font-size: 13px;
    opacity: 1;
  }

  .settings-link-item{
    padding: 10px 10px;
    border-radius: 14px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
  }
  .settings-link-item:active{ transform: scale(0.99); }
  #gameScreen .hud-lives-row .hearts,
  #livesHearts{
    color: #ff4a4a;
    text-shadow: 0 0 4px rgba(0,0,0,0.4);
  }

  /* =========================
     ‚úÖ YOUR REQUESTED CHANGES (minimal)
     ========================= */

  /* MENU: Play block sizing (+20% already), buttons centered */
  #menuScreen .play-btn-wrapper.menu-play-mid{
    margin-top: 18px;
    margin-bottom: 12px;
    align-items: center;
    gap: 14px; /* ‚úÖ more space between Play and Start */
  }
  #menuScreen .play-btn-wrapper.menu-play-mid .play-btn{
    width: min(340px, 92%);
  }
  #menuScreen .play-btn-wrapper.menu-play-mid #playButton.play-btn{
    padding: 17px 50px;
    font-size: 22px;
  }
  #menuScreen .play-btn-wrapper.menu-play-mid #startFromBeginningButton.play-btn.secondary{
    padding: 12px 28px;
    font-size: 15px;
  }

  /* MAIN MENU footer (Scoreboard at bottom) */
  #menuScreen .menu-footer{
    padding-bottom: 8px;
  }

  /* SCORE: bigger bottom back button */
  #scoreScreen #scoreBackBottomButton.play-btn.secondary{
    width: min(360px, 94%);
    padding: 16px 42px;
    font-size: 18px;
    border-radius: 999px;
  }

  /* SCORE: redesigned players list + highlight current user */
  #scoreScreen .scoreboard-players{
    gap: 8px;
  }
  #scoreScreen .scoreboard-player-card{
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(0,0,0,0.28);
    border: 1px solid rgba(255,255,255,0.10);
    font-size: 12px;
  }
  #scoreScreen .scoreboard-player-card .left{
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #scoreScreen .scoreboard-rank{
    width: 22px;
    text-align: center;
    font-weight: 900;
    opacity: 0.85;
  }
  #scoreScreen .scoreboard-player-card.is-me{
    background: linear-gradient(135deg, rgba(255,226,155,0.25), rgba(0,0,0,0.25));
    border-color: rgba(255,226,155,0.35);
  }
  #scoreScreen .scoreboard-score{
    font-size: 14px;
    font-weight: 900;
  }
</style>
<style id="coresdk-auth-styles">
            .coresdk-auth-backdrop {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 999999;
                animation: coresdk-fadeIn 0.2s ease;
            }

            @keyframes coresdk-fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes coresdk-slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .coresdk-auth-modal {
                background: #fff;
                border-radius: 16px;
                padding: 32px;
                width: 340px;
                max-width: 90vw;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                animation: coresdk-slideUp 0.3s ease;
            }

            .coresdk-auth-title {
                margin: 0 0 8px;
                font-size: 22px;
                font-weight: 600;
                color: #1a1a1a;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-subtitle {
                margin: 0 0 24px;
                font-size: 14px;
                color: #666;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-buttons {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .coresdk-auth-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
                padding: 14px 20px;
                border-radius: 12px;
                font-size: 15px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
                border: none;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .coresdk-auth-btn-google {
                background: #fff;
                border: 1px solid #ddd;
                color: #333;
            }

            .coresdk-auth-btn-google:hover:not(:disabled) {
                background: #f8f8f8;
                border-color: #ccc;
                transform: translateY(-1px);
            }

            .coresdk-auth-btn-guest {
                background: #333;
                color: #fff;
            }

            .coresdk-auth-btn-guest:hover:not(:disabled) {
                background: #444;
                transform: translateY(-1px);
            }

            .coresdk-auth-btn svg {
                flex-shrink: 0;
            }

            .coresdk-auth-hint {
                margin: 20px 0 0;
                font-size: 12px;
                color: #999;
                text-align: center;
                font-family: system-ui, -apple-system, sans-serif;
            }

            .coresdk-auth-btn.loading {
                pointer-events: none;
                opacity: 0.7;
            }

            .coresdk-auth-btn.loading span {
                opacity: 0.5;
            }
        </style><style id="quickform-styles">
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }
  </style><style id="quickform-picker-styles">
    .quickform-picker-highlight {
      outline: 2px solid #6366f1 !important;
      outline-offset: 2px !important;
      background-color: rgba(99, 102, 241, 0.1) !important;
    }
  </style></head>
<body>

<!-- SPLASH SCREEN -->
<div id="splashScreen" class="screen">
  <div class="splash-wrapper">
    <div class="splash-top-block">
      <div class="splash-title">Hidden Objects</div>
      <div class="splash-subtitle">
        Loading assets and preparing your cozy room‚Ä¶
      </div>
    </div>
    <div class="splash-loader">
      <div class="splash-spinner"></div>
      <div class="splash-loader-text">Loading‚Ä¶</div>
    </div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-dialog">
    <div class="login-title" id="loginTitle">Welcome back</div>
    <div class="login-subtitle" id="loginSubtitle">Log in to save your score and profile.</div>

    <div class="login-avatar-row" id="loginAvatarRow">
      <div class="login-avatar-large" id="loginAvatar">P</div>
      <div class="login-player-name" id="loginPlayerNameLabel">Player</div>
    </div>

    <div class="login-field" id="registerNameField" style="display:none;">
      <label for="registerName">Player name</label>
      <input id="registerName" type="text" placeholder="Your name (optional)" autocomplete="off">
    </div>

    <input id="avatarFileInput" type="file" accept="image/*" style="display:none">

    <div class="login-field">
      <label for="loginEmail">Email</label>
      <input id="loginEmail" type="email" placeholder="admin@gmail.com" autocomplete="off">
    </div>
    <div class="login-field">
      <label for="loginPassword">Password</label>
      <input id="loginPassword" type="password" placeholder="admin">
    </div>

    <button class="btn login-btn" id="loginSubmitBtn">Log in</button>
    <button class="btn secondary login-autofill-btn" id="loginAutofillBtn">
      Autologin as admin (test)
    </button>
    <button class="btn login-google-btn" id="loginGoogleBtn">
      Continue with Google (stub)
    </button>

    <button class="login-switch" id="switchAuthModeBtn">
      No account? Register
    </button>

    <div class="login-error" id="loginError"></div>
  </div>
</div>

<!-- TUTORIAL SCREEN -->
<div id="tutorialScreen" class="screen active">
  <div class="game-wrapper tutorial-wrapper">
    <div class="hud">
      <div class="hud-title-row">
        <span class="title-text">How to play</span>
      </div>
      <div class="hud-header">
        <span class="hud-progress">
          Tap these objects on the picture
        </span>
        <span class="hud-score">
          Score: <span id="scoreValue">0</span>
        </span>
        <span class="hud-lives">
          Hints:
          <span class="hearts" id="tutorialHintsCount">2</span>
        </span>
      </div>
    </div>

    <div class="game" id="tutorialGame" style="aspect-ratio: 1024 / 1536;">
      <button class="tutorial-skip-btn" id="tutorialSkipBtn">Skip</button>

      <div class="game-top-buttons">
        <button class="hint-button" id="tutorialHintButton" data-hints="2"></button>
      </div>

      <img src="./Find Objects ‚Äì Multi-level with Tutorial_files/room_bg.webp" class="game-bg" alt="Tutorial room" id="tutorialBg" draggable="false">

      <img src="./Find Objects ‚Äì Multi-level with Tutorial_files/book.webp" class="t-item" data-name="Book" data-x="604" data-y="940" data-w="132" data-h="198" draggable="false" style="left: 99.0938px; top: 154.219px; width: 21.6562px; height: 32.4844px;">

      <img src="./Find Objects ‚Äì Multi-level with Tutorial_files/car.webp" class="t-item" data-name="Car" data-x="-8" data-y="401" data-w="78" data-h="117" draggable="false" style="left: -1.3125px; top: 65.7891px; width: 12.7969px; height: 19.1953px;">

      <img src="./Find Objects ‚Äì Multi-level with Tutorial_files/camera.webp" class="t-item" data-name="Camera" data-x="42" data-y="799" data-w="79" data-h="119" draggable="false" style="left: 6.89062px; top: 131.086px; width: 12.9609px; height: 19.5234px;">

      <div class="tutorial-guide-overlay" id="tutorialGuideOverlay">
        <div class="tutorial-guide-box">
          <div class="tutorial-guide-title">Find the objects</div>
          <div class="tutorial-guide-text">
            Tap the highlighted object on the picture, then find the remaining ones.
          </div>
        </div>
      </div>

      <div class="overlay" id="tutorialOverlay">
        <div class="overlay-title">Nice! üéâ</div>
        <div class="overlay-text">
          You‚Äôve found all example objects.<br>Now you‚Äôre ready to play!
        </div>
        <button class="btn" id="tutorialContinueBtn">Continue</button>
      </div>
    </div>

    <div class="carousel" id="tutorialCarousel"><div class="carousel-item"><img class="carousel-icon" src="./Find Objects ‚Äì Multi-level with Tutorial_files/book.webp" alt="Book"><div class="carousel-label">Book</div></div><div class="carousel-item"><img class="carousel-icon" src="./Find Objects ‚Äì Multi-level with Tutorial_files/car.webp" alt="Car"><div class="carousel-label">Car</div></div><div class="carousel-item"><img class="carousel-icon" src="./Find Objects ‚Äì Multi-level with Tutorial_files/camera.webp" alt="Camera"><div class="carousel-label">Camera</div></div></div>

    <div class="tutorial-text">
      <p>‚Ä¢ At the bottom you see the objects to find.</p>
      <p>‚Ä¢ Tap the same objects on the picture.</p>
      <p>‚Ä¢ If it‚Äôs hard, tap the üí° button to highlight one object.</p>
    </div>
  </div>
</div>

<!-- MAIN MENU -->
<div id="menuScreen" class="screen">
  <div class="menu-wrapper">
    <div class="menu-header">
      <div class="player-info">
        <div class="player-avatar" id="menuPlayerAvatar">P</div>
        <div class="player-name" id="menuPlayerName">Player</div>
      </div>

      <!-- ‚úÖ removed "Menu" title -->

      <button class="menu-settings-btn" id="mainSettingsButton">‚öô</button>
    </div>

    <div class="menu-content">
      <div class="menu-logo">
        <div class="menu-logo-text">
          <span class="menu-logo-title-top">Hidden</span>
          <span class="menu-logo-title-bottom">Objects</span>
        </div>
      </div>

      <div class="menu-level-info">
        <div class="menu-level-label" id="menuLevelLabel">Level 1</div>
        <div class="menu-level-title" id="menuLevelTitle">Cartoon Room</div>
        <div class="menu-level-desc" id="menuLevelDesc">Find all hidden objects in this cozy cartoon living room.</div>
      </div>

      <!-- ‚úÖ Play buttons (middle area) -->
      <div class="play-btn-wrapper menu-play-mid">
        <button class="play-btn" id="playButton">Play</button>
        <button class="play-btn secondary" id="startFromBeginningButton">Start from beginning</button>
      </div>
    </div>

    <!-- ‚úÖ Scoreboard moved to the very bottom -->
    <div class="menu-footer">
      <button class="menu-section-btn" id="scoreboardButton">
        <div class="menu-section-left">
          <div class="menu-section-title">üèÜ Scoreboard</div>
          <div class="menu-section-sub">View your score and others</div>
        </div>
        <div class="menu-section-right">‚Ä∫</div>
      </button>
    </div>
  </div>
</div>

<!-- SCORE SCREEN -->
<div id="scoreScreen" class="screen">
  <div class="menu-wrapper score-wrapper">
    <div class="menu-header">
      <div class="player-info">
        <div class="player-avatar" id="scorePlayerAvatar">P</div>
        <div class="player-name" id="scorePlayerName">Player</div>
      </div>
      <div class="menu-header-title">Scores</div>
      <button class="menu-settings-btn" id="scoreBackButton">‚Üê</button>
    </div>

    <div class="menu-content">
      <div class="menu-level-info">
        <div class="menu-level-label">Your total score</div>
        <div class="menu-level-title" id="scoreTotalValue">0</div>
        <div class="menu-level-desc">
          In future updates, this screen will show a leaderboard of all players.
        </div>
      </div>

      <div class="menu-level-info">
        <div class="menu-level-label">Players</div>
        <!-- ‚úÖ now dynamically rendered (includes current player) -->
        <div class="scoreboard-players" id="scoreboardPlayers"><div class="scoreboard-player-card is-me"><div class="left"><div class="scoreboard-rank">1</div><div class="player-info"><div class="player-avatar">P</div><div class="player-name">Player (you)</div></div></div><div class="scoreboard-score">0</div></div><div class="scoreboard-player-card"><div class="left"><div class="scoreboard-rank">2</div><div class="player-info"><div class="player-avatar">A</div><div class="player-name">Alice</div></div></div><div class="scoreboard-score">0</div></div><div class="scoreboard-player-card"><div class="left"><div class="scoreboard-rank">3</div><div class="player-info"><div class="player-avatar">B</div><div class="player-name">Bob</div></div></div><div class="scoreboard-score">0</div></div><div class="scoreboard-player-card"><div class="left"><div class="scoreboard-rank">4</div><div class="player-info"><div class="player-avatar">C</div><div class="player-name">Carol</div></div></div><div class="scoreboard-score">0</div></div><div class="scoreboard-player-card"><div class="left"><div class="scoreboard-rank">5</div><div class="player-info"><div class="player-avatar">D</div><div class="player-name">Dan</div></div></div><div class="scoreboard-score">0</div></div></div>
      </div>
    </div>

    <div class="play-btn-wrapper">
      <button class="play-btn secondary" id="scoreBackBottomButton">Back to menu</button>
    </div>
  </div>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="screen">
  <div class="game-wrapper">
    <div class="hud game-hud">
      <div class="hud-topbar">
        <div class="hud-left-stack">
          <div class="hud-progress">
            Found <span id="foundCount">0</span>/<span id="totalCount">0</span>
          </div>

          <div class="player-info hud-player">
            <div class="player-avatar" id="gamePlayerAvatar">P</div>
            <div class="player-name" id="gamePlayerName">Player</div>
          </div>
        </div>

        <div class="hud-center-stack">
          <span class="title-text">Find all objects</span>
          <div class="hud-score">
            Score: <span id="scoreValueGame">0</span>
          </div>
        </div>

        <div class="hud-right-stack">
          <div class="hud-lives-row">
            Lives:
            <span class="hearts" id="livesHearts">‚ù§‚ù§‚ù§</span>
          </div>
          <div class="hud-level" id="hudLevelValue">Level 1</div>
        </div>
      </div>
    </div>

    <div class="game" id="game" style="aspect-ratio: 1024 / 1536;">
      <div class="game-top-buttons">
        <button class="hint-button" id="hintButton" data-hints="2"></button>
        <button class="menu-button" id="menuButton">‚ò∞</button>
      </div>

      <img src="./Find Objects ‚Äì Multi-level with Tutorial_files/room_bg.webp" class="game-bg" alt="room" id="roomBg" draggable="false">

      <div class="overlay" id="overlay">
        <div class="overlay-title" id="overlayTitle">You found everything! üéâ</div>
        <div class="overlay-text" id="overlayText">
          Great job! All objects have been collected.
        </div>

        <div class="overlay-actions">
          <button class="btn" id="reviveBtn">Watch ad ‚Äî get +1 life</button>
          <button class="btn" id="restartBtn">Play again</button>
        </div>
      </div>
    </div>

    <div class="carousel" id="carousel"></div>
  </div>
</div>

<!-- SETTINGS OVERLAY (redesigned blocks) -->
<div class="settings-overlay" id="settingsOverlay">
  <div class="settings-panel" id="settingsPanel">
    <button class="settings-close" id="settingsCloseBtn">‚úï</button>
    <div class="settings-title">Settings</div>

    <!-- GENERAL -->
    <div class="settings-section" id="settingsSectionGeneral">
      <div class="settings-section-title">General</div>

      <div class="settings-row">
        <span class="settings-label">Language</span>
        <button class="settings-toggle off" id="languageButton" disabled="">English</button>
      </div>
    </div>

    <!-- SOUND -->
    <div class="settings-section" id="settingsSectionSound">
      <div class="settings-section-title">Sound</div>

      <div class="settings-row">
        <span class="settings-label">Sound</span>
        <button class="settings-toggle on" id="soundToggle">On</button>
      </div>
    </div>

    <!-- AUTH -->
    <div class="settings-section" id="settingsSectionAuth">
      <div class="settings-section-title">Account</div>
      <div class="settings-auth">
        <div class="settings-status logged-in" id="authStatus">Logged in as Guest. You can upgrade to Google.</div>
        <button class="btn settings-btn-auth" id="loginGuestButton" style="display: none;">Login as Guest</button>
        <button class="btn settings-btn-auth" id="loginGoogleButton" style="display: block;">Login with Google</button>
        <button class="btn settings-btn-auth settings-btn-logout" id="logoutButton" style="display: block;">Logout</button>
      </div>
    </div>

    <!-- SITES / LINKS (–≤–∏–¥–Ω–æ –∏–∑ –º–µ–Ω—é) -->
    <div class="settings-section" id="settingsSectionLinks">
      <div class="settings-section-title">Sites</div>

      <div class="settings-links" id="settingsLinks">
        <div class="settings-link-item" data-link="privacy">Privacy Policy</div>
        <div class="settings-link-item" data-link="terms">Terms of Use</div>
        <div class="settings-link-item" data-link="site">Our Site</div>
      </div>
    </div>

    <!-- ACTIONS (–≤–∏–¥–Ω–æ –≤ –∏–≥—Ä–µ) -->
    <div class="settings-section" id="settingsSectionActions">
      <div class="settings-section-title">Actions</div>

      <button class="btn settings-btn-restart" id="settingsRestartBtn">Start over</button>
      <button class="btn settings-btn-exit" id="settingsExitBtn">Exit to menu</button>
    </div>
  </div>
</div>

<!-- REWARDED AD STUB (modal) -->
<div class="ad-overlay" id="adOverlay">
  <div class="ad-dialog">
    <div class="ad-title" id="adTitle">Ad</div>
    <div class="ad-text" id="adText">
      This is a stub. Press ‚ÄúGet reward‚Äù to instantly receive the reward.
    </div>
    <div class="ad-actions">
      <button class="btn secondary" id="adCancelBtn">Cancel</button>
      <button class="btn" id="adRewardBtn">Get reward</button>
    </div>
  </div>
</div>

<script>
  async function startAiGame() {

console.log(coreSDK.getAuthStatus(),"+++++++++++++++++++++++++")
  const splashScreen   = document.getElementById('splashScreen');
  const tutorialScreen = document.getElementById('tutorialScreen');
  const menuScreen     = document.getElementById('menuScreen');
  const gameScreen     = document.getElementById('gameScreen');
  const scoreScreen    = document.getElementById('scoreScreen');

  const playButton   = document.getElementById('playButton');
  const startFromBeginningButton = document.getElementById('startFromBeginningButton');
  const mainSettingsButton = document.getElementById('mainSettingsButton');
  const scoreboardButton   = document.getElementById('scoreboardButton');

  const menuLevelLabel = document.getElementById('menuLevelLabel');
  const menuLevelTitle = document.getElementById('menuLevelTitle');
  const menuLevelDesc  = document.getElementById('menuLevelDesc');

  const game         = document.getElementById('game');
  const bg           = document.getElementById('roomBg');
  const foundCountEl = document.getElementById('foundCount');
  const totalCountEl = document.getElementById('totalCount');
  const livesHearts  = document.getElementById('livesHearts');
  const hudLevelValue = document.getElementById('hudLevelValue');
  const overlay      = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlayTitle');
  const overlayText  = document.getElementById('overlayText');
  const restartBtn   = document.getElementById('restartBtn');
  const reviveBtn    = document.getElementById('reviveBtn');
  const carousel     = document.getElementById('carousel');
  const menuButton   = document.getElementById('menuButton');
  const hintButton   = document.getElementById('hintButton');

  const settingsOverlay  = document.getElementById('settingsOverlay');
  const settingsCloseBtn = document.getElementById('settingsCloseBtn');
  const soundToggle      = document.getElementById('soundToggle');
  const settingsRestart  = document.getElementById('settingsRestartBtn');
  const settingsExitBtn  = document.getElementById('settingsExitBtn');
  const settingsLinks    = document.getElementById('settingsLinks');

  // Settings sections
  const settingsSectionLinks   = document.getElementById('settingsSectionLinks');
  const settingsSectionActions = document.getElementById('settingsSectionActions');

  // Auth elements
  const loginGuestButton  = document.getElementById('loginGuestButton');
  const loginGoogleButton = document.getElementById('loginGoogleButton');
  const logoutButton      = document.getElementById('logoutButton');
  const authStatusEl      = document.getElementById('authStatus');

  // Ad stub UI
  const adOverlay   = document.getElementById('adOverlay');
  const adTitleEl   = document.getElementById('adTitle');
  const adTextEl    = document.getElementById('adText');
  const adCancelBtn = document.getElementById('adCancelBtn');
  const adRewardBtn = document.getElementById('adRewardBtn');

  const tutorialGame        = document.getElementById('tutorialGame');
  const tutorialBg          = document.getElementById('tutorialBg');
  const tutorialItems       = document.querySelectorAll('.t-item');
  const tutorialCarousel    = document.getElementById('tutorialCarousel');
  const tutorialHintButton  = document.getElementById('tutorialHintButton');
  const tutorialHintsCount  = document.getElementById('tutorialHintsCount');
  const tutorialOverlay     = document.getElementById('tutorialOverlay');
  const tutorialContinueBtn = document.getElementById('tutorialContinueBtn');
  const tutorialGuideOverlay = document.getElementById('tutorialGuideOverlay');
  const tutorialSkipBtn     = document.getElementById('tutorialSkipBtn');

  // SCORE UI
  const scoreValueTutorial = document.getElementById('scoreValue');
  const scoreValueGame     = document.getElementById('scoreValueGame');
  const scoreTotalValueEl  = document.getElementById('scoreTotalValue');
  const scoreBackButton    = document.getElementById('scoreBackButton');
  const scoreBackBottomButton = document.getElementById('scoreBackBottomButton');
  const scoreboardPlayersEl = document.getElementById('scoreboardPlayers'); // ‚úÖ new

  // LOGIN UI
  const loginOverlay     = document.getElementById('loginOverlay');
  const loginTitleEl     = document.getElementById('loginTitle');
  const loginSubtitleEl  = document.getElementById('loginSubtitle');
  const loginEmailInput  = document.getElementById('loginEmail');
  const loginPasswordInput = document.getElementById('loginPassword');
  const loginSubmitBtn   = document.getElementById('loginSubmitBtn');
  const loginAutofillBtn = document.getElementById('loginAutofillBtn');
  const loginGoogleBtn   = document.getElementById('loginGoogleBtn');
  const loginErrorText   = document.getElementById('loginError');
  const loginAvatar      = document.getElementById('loginAvatar');
  const loginPlayerNameLabel = document.getElementById('loginPlayerNameLabel');
  const registerNameField   = document.getElementById('registerNameField');
  const registerNameInput   = document.getElementById('registerName');
  const switchAuthModeBtn   = document.getElementById('switchAuthModeBtn');
  const avatarFileInput     = document.getElementById('avatarFileInput');
  const loginAvatarRow      = document.getElementById('loginAvatarRow');

  // PLAYER INFO
  const menuPlayerAvatar = document.getElementById('menuPlayerAvatar');
  const menuPlayerName   = document.getElementById('menuPlayerName');
  const gamePlayerAvatar = document.getElementById('gamePlayerAvatar');
  const gamePlayerName   = document.getElementById('gamePlayerName');
  const scorePlayerAvatar = document.getElementById('scorePlayerAvatar');
  const scorePlayerName   = document.getElementById('scorePlayerName');

  let tutorialFound = 0;
  let tutorialHints = 2;
  let tutorialGuideActive = false;
  let tutorialFocusItem = null;

  const BG_WIDTH  = 1024;
  const BG_HEIGHT = 1536;

  const SOUND_KEY       = 'findit_sound_enabled';
  const PROGRESS_KEY    = 'findit_max_level';
  const SCORE_KEY       = 'findit_total_score';

  const PLAYER_NAME_KEY    = 'findit_player_name';
  const PLAYER_EMAIL_KEY   = 'findit_player_email';
  const PLAYER_AVATAR_KEY  = 'findit_player_avatar';
  const PLAYER_PASSWORD_KEY = 'findit_player_password';

  // NEW: in-progress (level session) save key
  const INPROGRESS_KEY = 'findit_inprogress_v1';

  // AUDIO LAZY LOADING
  const AUDIO_URLS = {
    menuMusic: 'https://stage-configs.artintgames.com/v1/storage/view/9/home music.mp3',
    hit: 'https://stage-configs.artintgames.com/v1/storage/view/9/hit.mp3',
    miss: 'https://stage-configs.artintgames.com/v1/storage/view/9/miss.mp3',
    win: 'https://stage-configs.artintgames.com/v1/storage/view/9/win.mp3',
    lose: 'https://stage-configs.artintgames.com/v1/storage/view/9/lose.mp3'
  };
  const audioCache = {};

  function getAudio(key) {
    if (!audioCache[key] && AUDIO_URLS[key]) {
      audioCache[key] = new Audio(AUDIO_URLS[key]);
      if (key === 'menuMusic') {
        audioCache[key].loop = true;
        audioCache[key].volume = 0.02;
      } else if (key === 'hit' || key === 'miss') {
        audioCache[key].volume = 0.5;
      } else {
        audioCache[key].volume = 0.6;
      }
    }
    return audioCache[key];
  }

  // Sound key constants for playSound()
  const soundHit = 'hit';
  const soundMiss = 'miss';
  const soundWin = 'win';
  const soundLose = 'lose';

  let currentMusic = null;

  // Load LEVELS from remote config via initConfigs
  const configResult = await coreSDK.initConfigs({
    version: '2.0.0',
    keys: ['testpic-init']
  });
  const LEVELS = configResult.get('testpic-init.LEVELS');

  let currentLevelIndex = 0;
  let maxUnlockedLevel  = 1;
  let items = [];


  let foundCount  = 0;
  let lives       = 3;
  const maxLives  = 3;

  // ===== Rewarded ads stubs config =====
  const MAX_AD_REVIVES_PER_LEVEL = 1;
  let adRevivesLeft = MAX_AD_REVIVES_PER_LEVEL;

  let gameOver    = false;
  let soundEnabled = true;
  let hintsLeft   = 2;
  const maxHints  = 2;
  let overlayMode = 'restart';

  let totalScore = 0;

  let playerName = 'Player';
  let playerEmail = '';
  let playerAvatarSymbol = '';
  let authMode = 'login';

  let pendingAdReward = null; // callback for ad stub

  // =========================
  // NEW: In-progress save/load (localStorage) ‚Äì future server-ready
  // =========================
  function safeParseJSON(str) {
    try { return JSON.parse(str); } catch (e) { return null; }
  }

  function getInProgressState() {
    const raw = localStorage.getItem(INPROGRESS_KEY);
    if (!raw) return null;
    const obj = safeParseJSON(raw);
    if (!obj || typeof obj !== 'object') return null;
    return obj;
  }

  function clearInProgress() {
    try { localStorage.removeItem(INPROGRESS_KEY); } catch (e) {}
  }

  // Save only when level NOT finished
  function saveInProgress(reason) {
    if (!gameScreen.classList.contains('active')) return;

    const level = LEVELS[currentLevelIndex];
    if (!level) return;

    if (foundCount >= items.length) {
      clearInProgress();
      return;
    }

    const foundNames = items
      .filter(it => it.dataset.found === 'true')
      .map(it => String(it.dataset.name || ''));

    const nothingToSave =
      foundNames.length === 0 &&
      lives === maxLives &&
      hintsLeft === maxHints &&
      adRevivesLeft === MAX_AD_REVIVES_PER_LEVEL &&
      !gameOver;

    if (nothingToSave) {
      clearInProgress();
      return;
    }

    const payload = {
      version: 1,
      savedAt: Date.now(),
      reason: reason || 'manual',
      levelId: level.id,
      levelKey: level.key,
      levelIndex: currentLevelIndex,

      foundNames,
      lives,
      hintsLeft,
      adRevivesLeft,
      gameOver: !!gameOver
    };

    try { localStorage.setItem(INPROGRESS_KEY, JSON.stringify(payload)); } catch (e) {}
  }

  function hasInProgressForLevel(levelIndex) {
    const st = getInProgressState();
    if (!st) return false;
    const lvl = LEVELS[levelIndex];
    if (!lvl) return false;
    return st.levelId === lvl.id && st.levelKey === lvl.key;
  }

  // Apply saved state AFTER buildLevel has created items + carousel
  function restoreInProgressIfAny(levelIndex) {
    const st = getInProgressState();
    const lvl = LEVELS[levelIndex];
    if (!st || !lvl) return false;

    if (st.levelId !== lvl.id || st.levelKey !== lvl.key) return false;

    const foundSet = new Set(Array.isArray(st.foundNames) ? st.foundNames : []);
    const savedLives = Number.isFinite(st.lives) ? Math.max(0, Math.min(maxLives, st.lives)) : maxLives;
    const savedHints = Number.isFinite(st.hintsLeft) ? Math.max(0, Math.min(maxHints, st.hintsLeft)) : maxHints;
    const savedAdRevives = Number.isFinite(st.adRevivesLeft) ? Math.max(0, Math.min(MAX_AD_REVIVES_PER_LEVEL, st.adRevivesLeft)) : MAX_AD_REVIVES_PER_LEVEL;

    foundCount = 0;
    lives = savedLives;
    hintsLeft = savedHints;
    adRevivesLeft = savedAdRevives;
    gameOver = !!st.gameOver;

    overlay.classList.remove('visible', 'win', 'lose');
    if (reviveBtn) reviveBtn.style.display = 'none';

    items.forEach(item => {
      item.classList.remove('hint-highlight');
      const isFound = foundSet.has(String(item.dataset.name || ''));
      item.dataset.found = isFound ? 'true' : 'false';

      if (isFound) {
        foundCount++;
        item.style.opacity = '0';
        item.style.transform = 'scale(0.8)';
        item.style.pointerEvents = 'none';
        if (item._carouselItem) item._carouselItem.classList.add('found');
      } else {
        item.style.opacity = '1';
        item.style.transform = '';
        item.style.pointerEvents = gameOver ? 'none' : 'auto';
        if (item._carouselItem) item._carouselItem.classList.remove('found');
      }
    });

    foundCountEl.textContent = String(foundCount);
    totalCountEl.textContent = String(items.length);

    updateLivesUI();
    updateHintUI();
    updateScoreUI();
    updateGameLevelLabel();

    return true;
  }

  function setActiveScreen(screenEl) {
    [splashScreen, tutorialScreen, menuScreen, gameScreen, scoreScreen].forEach(el => {
      if (!el) return;
      el.classList.toggle('active', el === screenEl);
    });

    requestAnimationFrame(() => {
      layoutItems();
      layoutTutorialItems();
    });
  }

  function stopCurrentMusic() {
    if (currentMusic) {
      try { currentMusic.pause(); } catch (e) {}
    }
  }

  function getLevelMusic(levelIndex) {
    const level = LEVELS[levelIndex];
    if (!level || !level.music) return null;
    if (!level._musicAudio) {
      level._musicAudio = new Audio(level.music);
      level._musicAudio.loop = true;
      level._musicAudio.volume = 0.2;
    }
    return level._musicAudio;
  }

  function startMenuMusic() {
    if (!soundEnabled) return;
    const menuMusic = getAudio('menuMusic');
    if (currentMusic && currentMusic !== menuMusic) {
      try { currentMusic.pause(); } catch (e) {}
    }
    currentMusic = menuMusic;
    if (menuMusic && menuMusic.paused) {
      menuMusic.play().catch(() => {});
    }
  }

  function startLevelMusic(index) {
    if (!soundEnabled) return;
    const m = getLevelMusic(index);
    if (!m) return;
    if (currentMusic && currentMusic !== m) {
      try { currentMusic.pause(); } catch (e) {}
    }
    currentMusic = m;
    if (m.paused) {
      m.play().catch(() => {});
    }
  }

  function loadScore() {
    try {
      const stored = localStorage.getItem(SCORE_KEY);
      if (stored !== null) {
        const n = parseInt(stored, 10);
        if (Number.isFinite(n) && n >= 0) totalScore = n;
      }
    } catch (e) { totalScore = 0; }
  }

  function saveScore() {
    try { localStorage.setItem(SCORE_KEY, String(totalScore)); } catch (e) {}
  }

  // ‚úÖ scoreboard (includes current player)
  function getStubPlayers(){
    return [
      { name: 'Alice', avatar: 'A', score: 0 },
      { name: 'Bob',   avatar: 'B', score: 0 },
      { name: 'Carol', avatar: 'C', score: 0 },
      { name: 'Dan',   avatar: 'D', score: 0 }
    ];
  }

  function getMyPlayerEntry(){
    const name = (playerName || 'Player').trim();
    const initial = name.charAt(0).toUpperCase() || 'P';
    return { name, avatar: initial, score: totalScore, isMe: true };
  }

  function renderScoreboard(){
    if (!scoreboardPlayersEl) return;

    const my = getMyPlayerEntry();
    const others = getStubPlayers();

    const normalizedMy = my.name.toLowerCase();
    const merged = [my, ...others.filter(p => (p.name || '').toLowerCase() !== normalizedMy)];

    merged.sort((a,b) => (b.score||0) - (a.score||0));

    scoreboardPlayersEl.innerHTML = '';

    merged.forEach((p, idx) => {
      const card = document.createElement('div');
      card.className = 'scoreboard-player-card' + (p.isMe ? ' is-me' : '');

      const left = document.createElement('div');
      left.className = 'left';

      const rank = document.createElement('div');
      rank.className = 'scoreboard-rank';
      rank.textContent = String(idx + 1);

      const info = document.createElement('div');
      info.className = 'player-info';

      const av = document.createElement('div');
      av.className = 'player-avatar';

      if (p.isMe && playerAvatarSymbol && playerAvatarSymbol.startsWith('data:image/')) {
        av.style.backgroundImage = 'url(' + playerAvatarSymbol + ')';
        av.textContent = '';
      } else {
        av.style.backgroundImage = '';
        av.textContent = (p.avatar || 'P').toUpperCase();
      }

      const nm = document.createElement('div');
      nm.className = 'player-name';
      nm.textContent = p.name + (p.isMe ? ' (you)' : '');

      info.appendChild(av);
      info.appendChild(nm);

      left.appendChild(rank);
      left.appendChild(info);

      const score = document.createElement('div');
      score.className = 'scoreboard-score';
      score.textContent = String(p.score || 0);

      card.appendChild(left);
      card.appendChild(score);

      scoreboardPlayersEl.appendChild(card);
    });
  }

  function updateScoreUI() {
    if (scoreValueTutorial) scoreValueTutorial.textContent = totalScore;
    if (scoreValueGame)     scoreValueGame.textContent     = totalScore;
    if (scoreTotalValueEl)  scoreTotalValueEl.textContent  = totalScore;
    renderScoreboard();
  }

  function addScore(points) {
    totalScore += points;
    updateScoreUI();
    saveScore();
  }

  function deriveNameFromEmail(email) {
    if (!email) return 'Player';
    const before = email.split('@')[0] || 'Player';
    return before.charAt(0).toUpperCase() + before.slice(1);
  }

  function updatePlayerUI() {
    const name = playerName || 'Player';
    const fallbackInitial = name.trim().charAt(0).toUpperCase() || 'P';
    const avatarSource = playerAvatarSymbol;

    function applyAvatar(el) {
      if (!el) return;
      el.style.backgroundImage = '';
      if (avatarSource && avatarSource.startsWith('data:image/')) {
        el.style.backgroundImage = 'url(' + avatarSource + ')';
        el.textContent = '';
      } else {
        el.textContent = avatarSource || fallbackInitial;
      }
    }

    applyAvatar(loginAvatar);
    if (loginPlayerNameLabel) loginPlayerNameLabel.textContent = name;

    applyAvatar(menuPlayerAvatar);
    if (menuPlayerName) menuPlayerName.textContent = name;

    applyAvatar(gamePlayerAvatar);
    if (gamePlayerName) gamePlayerName.textContent = name;

    applyAvatar(scorePlayerAvatar);
    if (scorePlayerName) scorePlayerName.textContent = name;

    renderScoreboard();
  }

  function loadPlayerFromStorage() {
    try {
      const storedName = localStorage.getItem(PLAYER_NAME_KEY);
      const storedEmail = localStorage.getItem(PLAYER_EMAIL_KEY);
      const storedAvatar = localStorage.getItem(PLAYER_AVATAR_KEY);

      if (storedName) playerName = storedName;
      if (storedEmail) playerEmail = storedEmail;
      if (storedAvatar) playerAvatarSymbol = storedAvatar;
    } catch (e) {}
  }

  function showLoginOverlay() {
    authMode = 'login';
    applyAuthMode();
    loginEmailInput.value = playerEmail || '';
    loginPasswordInput.value = '';
    registerNameInput.value = '';
    loginErrorText.textContent = '';
    loginOverlay.classList.add('visible');
    document.body.classList.add('login-active');
  }

  function hideLoginOverlay() {
    loginOverlay.classList.remove('visible');
    document.body.classList.remove('login-active');
  }

  // Tutorial done logic (per-user)
  const TUTORIAL_DONE_KEY_PREFIX = 'findit_tutorial_done_';

  function getTutorialDoneKeyForCurrentUser() {
    const emailKey = (playerEmail || '').trim().toLowerCase();
    const safe = emailKey || (playerName || 'player').trim().toLowerCase().replace(/\s+/g, '_');
    return TUTORIAL_DONE_KEY_PREFIX + safe;
  }

  function hasUserCompletedTutorial() {
    const k = getTutorialDoneKeyForCurrentUser();
    try { return localStorage.getItem(k) === 'true'; } catch(e) { return false; }
  }

  function markUserCompletedTutorial() {
    const k = getTutorialDoneKeyForCurrentUser();
    try { localStorage.setItem(k, 'true'); } catch(e) {}
  }

  function goAfterLogin() {
    if (hasUserCompletedTutorial()) {
      setActiveScreen(menuScreen);
      applyLevelInfoToMenu(currentLevelIndex);
      updateScoreUI();
      updatePlayerUI();
      startMenuMusic();
      return;
    }
    initTutorial();
  }

  function performLogin(email, password) {
    loginErrorText.textContent = '';

    if (!email || !password) {
      loginErrorText.textContent = 'Enter email and password.';
      return;
    }

    let storedEmail = null;
    let storedPassword = null;
    let storedName = null;
    let storedAvatar = null;

    try {
      storedEmail = localStorage.getItem(PLAYER_EMAIL_KEY);
      storedPassword = localStorage.getItem(PLAYER_PASSWORD_KEY);
      storedName = localStorage.getItem(PLAYER_NAME_KEY);
      storedAvatar = localStorage.getItem(PLAYER_AVATAR_KEY);
    } catch (e) {}

    if (storedEmail && storedPassword && email === storedEmail && password === storedPassword) {
      playerEmail = storedEmail;
      playerName  = storedName || deriveNameFromEmail(storedEmail);
      playerAvatarSymbol = storedAvatar || '';
      updatePlayerUI();
      hideLoginOverlay();
      goAfterLogin();
      return;
    }

    if (email === 'admin@gmail.com' && password === 'admin') {
      playerEmail = email;
      playerName  = deriveNameFromEmail(email);
      playerAvatarSymbol = '';
      updatePlayerUI();
      hideLoginOverlay();
      goAfterLogin();
      return;
    }

    loginErrorText.textContent = 'Invalid credentials.';
  }

  function performRegistration(nameInput, email, password) {
    loginErrorText.textContent = '';

    if (!email || !password) {
      loginErrorText.textContent = 'Enter email and password.';
      return;
    }

    const name = nameInput || deriveNameFromEmail(email);
    const avatar = playerAvatarSymbol || '';

    try {
      localStorage.setItem(PLAYER_EMAIL_KEY, email);
      localStorage.setItem(PLAYER_PASSWORD_KEY, password);
      localStorage.setItem(PLAYER_NAME_KEY, name);
      localStorage.setItem(PLAYER_AVATAR_KEY, avatar);
    } catch (e) {}

    playerEmail = email;
    playerName = name;
    playerAvatarSymbol = avatar;

    updatePlayerUI();
    hideLoginOverlay();
    goAfterLogin();
  }

  function applyAuthMode() {
    if (authMode === 'login') {
      loginTitleEl.textContent = 'Welcome back';
      loginSubtitleEl.textContent = 'Log in to save your score and profile.';
      registerNameField.style.display = 'none';
      loginSubmitBtn.textContent = 'Log in';
      loginAutofillBtn.style.display = 'block';
      loginGoogleBtn.style.display = 'block';
      switchAuthModeBtn.textContent = 'No account? Register';
    } else {
      loginTitleEl.textContent = 'Create account';
      loginSubtitleEl.textContent = 'Set up your player profile.';
      registerNameField.style.display = 'flex';
      loginSubmitBtn.textContent = 'Register';
      loginAutofillBtn.style.display = 'none';
      loginGoogleBtn.style.display = 'none';
      switchAuthModeBtn.textContent = 'Already have an account? Log in';
    }
    if (loginAvatarRow) loginAvatarRow.style.display = (authMode === 'login') ? 'none' : 'flex';
  }

  // Boot flow (unchanged)
  setTimeout(() => {
    setActiveScreen(tutorialScreen);
    // Only show login overlay if not authenticated
    const authStatus = coreSDK.getAuthStatus();
    if (!authStatus || !authStatus.isAuthenticated) {
      showLoginOverlay();
    }
  }, 1500);

  function applyLevelInfoToMenu(index) {
    const level = LEVELS[index];
    menuLevelLabel.textContent = `Level ${level.id}`;
    menuLevelTitle.textContent = level.menuTitle;
    menuLevelDesc.textContent  = level.menuDescription;
  }

  function setSoundEnabled(value) {
    soundEnabled = value;
    soundToggle.textContent = soundEnabled ? 'On' : 'Off';
    soundToggle.classList.toggle('on',  soundEnabled);
    soundToggle.classList.toggle('off', !soundEnabled);
    try { localStorage.setItem(SOUND_KEY, String(soundEnabled)); } catch (e) {}

    if (!soundEnabled) {
      stopCurrentMusic();
    } else {
      if (menuScreen.classList.contains('active') || scoreScreen.classList.contains('active')) {
        startMenuMusic();
      } else if (gameScreen.classList.contains('active')) {
        startLevelMusic(currentLevelIndex);
      }
    }
  }

  function playSound(key) {
    if (!soundEnabled || !key) return;
    const audio = getAudio(key);
    if (!audio) return;
    try { audio.currentTime = 0; audio.play().catch(() => {}); } catch (e) {}
  }

  // Rewarded Ad Stub
  function showRewardedAdStub({ title, text, onReward }) {
    pendingAdReward = (typeof onReward === 'function') ? onReward : null;
    if (adTitleEl) adTitleEl.textContent = title || 'Ad';
    if (adTextEl)  adTextEl.textContent  = text  || 'Ad stub';
    if (adOverlay) adOverlay.classList.add('visible');
  }

  function hideRewardedAdStub() {
    if (adOverlay) adOverlay.classList.remove('visible');
    pendingAdReward = null;
  }

  adCancelBtn && adCancelBtn.addEventListener('click', () => hideRewardedAdStub());
  adRewardBtn && adRewardBtn.addEventListener('click', () => {
    const cb = pendingAdReward;
    hideRewardedAdStub();
    if (typeof cb === 'function') cb();
  });

  adOverlay && adOverlay.addEventListener('click', (e) => {
    if (!e.target.closest('.ad-dialog')) hideRewardedAdStub();
  });

  function updateLivesUI() {
    const heartsStr = '‚ù§'.repeat(lives) + '‚ô°'.repeat(maxLives - lives);
    livesHearts.textContent = heartsStr;
  }

  function updateHintUI() {
    hintButton.dataset.hints = hintsLeft;
    hintButton.disabled = gameOver || settingsOverlay.classList.contains('visible');
  }

  function updateGameLevelLabel(){
    if (!hudLevelValue) return;
    const lvl = LEVELS[currentLevelIndex];
    hudLevelValue.textContent = lvl ? `Level ${lvl.id}` : 'Level';
  }

  // contain mapping
  function getContainMapping(containerEl, bgW, bgH) {
    const cw = containerEl.clientWidth;
    const ch = containerEl.clientHeight;
    if (!cw || !ch) return { scale: 1, offsetX: 0, offsetY: 0, renderW: cw, renderH: ch };

    const scale = Math.min(cw / bgW, ch / bgH);
    const renderW = bgW * scale;
    const renderH = bgH * scale;
    const offsetX = (cw - renderW) / 2;
    const offsetY = (ch - renderH) / 2;

    return { scale, offsetX, offsetY, renderW, renderH };
  }

  function layoutItems() {
    if (!items || items.length === 0) return;

    const map = getContainMapping(game, BG_WIDTH, BG_HEIGHT);

    items.forEach(item => {
      const x = parseFloat(item.dataset.x) || 0;
      const y = parseFloat(item.dataset.y) || 0;
      const w = parseFloat(item.dataset.w) || 150;
      const h = parseFloat(item.dataset.h) || 150;

      item.style.left   = (map.offsetX + x * map.scale) + 'px';
      item.style.top    = (map.offsetY + y * map.scale) + 'px';
      item.style.width  = (w * map.scale) + 'px';
      item.style.height = (h * map.scale) + 'px';
    });
  }

  function initGameLayout() {
    game.style.aspectRatio = BG_WIDTH + ' / ' + BG_HEIGHT;
    layoutItems();
  }

  if (bg.complete) initGameLayout();
  else bg.addEventListener('load', initGameLayout);

  function layoutTutorialItems() {
    const map = getContainMapping(tutorialGame, BG_WIDTH, BG_HEIGHT);

    tutorialItems.forEach(item => {
      const x = parseFloat(item.dataset.x) || 0;
      const y = parseFloat(item.dataset.y) || 0;
      const w = parseFloat(item.dataset.w) || 150;
      const h = parseFloat(item.dataset.h) || 150;

      item.style.left   = (map.offsetX + x * map.scale) + 'px';
      item.style.top    = (map.offsetY + y * map.scale) + 'px';
      item.style.width  = (w * map.scale) + 'px';
      item.style.height = (h * map.scale) + 'px';
    });
  }

  function initTutorialLayout() {
    tutorialGame.style.aspectRatio = BG_WIDTH + ' / ' + BG_HEIGHT;
    layoutTutorialItems();
  }

  if (tutorialBg.complete) initTutorialLayout();
  else tutorialBg.addEventListener('load', initTutorialLayout);

  let resizeRAF;
  window.addEventListener('resize', () => {
    if (resizeRAF) cancelAnimationFrame(resizeRAF);
    resizeRAF = requestAnimationFrame(() => {
      layoutItems();
      layoutTutorialItems();
    });
  });

  function loadProgress() {
    try {
      const stored = localStorage.getItem(PROGRESS_KEY);
      if (stored !== null) {
        const n = parseInt(stored, 10);
        if (Number.isFinite(n)) maxUnlockedLevel = Math.min(Math.max(1, n), LEVELS.length);
      }
    } catch (e) { maxUnlockedLevel = 1; }
    currentLevelIndex = maxUnlockedLevel - 1;
  }

  function saveProgress() {
    try { localStorage.setItem(PROGRESS_KEY, String(maxUnlockedLevel)); } catch (e) {}
  }

  function unlockLevel(levelNumber) {
    if (levelNumber > maxUnlockedLevel) {
      maxUnlockedLevel = Math.min(levelNumber, LEVELS.length);
      saveProgress();
    }
  }

  (function initSoundFromStorage() {
    try {
      const stored = localStorage.getItem(SOUND_KEY);
      soundEnabled = (stored === null) ? true : (stored === 'true');
    } catch (e) { soundEnabled = true; }
    setSoundEnabled(soundEnabled);
  })();

  loadProgress();
  loadScore();
  loadPlayerFromStorage();
  applyLevelInfoToMenu(currentLevelIndex);
  updateScoreUI();
  updatePlayerUI();
  updateGameLevelLabel();

  function buildLevel(levelIndex) {
    const level = LEVELS[levelIndex];
    currentLevelIndex = levelIndex;

    updateGameLevelLabel();

    bg.src = level.bg;

    document.querySelectorAll('.item').forEach(el => el.remove());
    carousel.innerHTML = '';
    items = [];

    level.items.forEach(cfg => {
      const img = document.createElement('img');
      img.className = 'item';
      img.src = cfg.src;
      img.alt = cfg.name;
      img.dataset.name = cfg.name;
      img.dataset.x = cfg.x;
      img.dataset.y = cfg.y;
      img.dataset.w = cfg.w;
      img.dataset.h = cfg.h;
      img.draggable = false;

      game.appendChild(img);
      items.push(img);

      const slide = document.createElement('div');
      slide.className = 'carousel-item';

      const icon = document.createElement('img');
      icon.className = 'carousel-icon';
      icon.src = cfg.src;
      icon.alt = cfg.name;

      const label = document.createElement('div');
      label.className = 'carousel-label';
      label.textContent = cfg.name;

      slide.appendChild(icon);
      slide.appendChild(label);

      img._carouselItem = slide;
      carousel.appendChild(slide);
    });

    totalCountEl.textContent = items.length;
    layoutItems();
  }

  function showOverlay(title, text, type) {
    overlayTitle.textContent = title;
    overlayText.textContent  = text;
    overlay.classList.remove('win', 'lose');
    overlay.classList.add('visible');

    if (type === 'lose') {
      overlay.classList.add('lose');
      playSound(soundLose);
      overlayMode = 'restart';
      restartBtn.textContent = 'Try again';

      if (reviveBtn) {
        reviveBtn.style.display = (adRevivesLeft > 0) ? 'block' : 'none';
        reviveBtn.textContent = `Watch ad ‚Äî get +1 life (${adRevivesLeft})`;
      }

    } else if (type === 'win') {
      if (reviveBtn) reviveBtn.style.display = 'none';

      const isLast = (currentLevelIndex === LEVELS.length - 1);

      if (isLast) {
        overlayMode = 'restart';
        restartBtn.textContent = 'Play again';
      } else {
        overlayMode = 'next-level';
        restartBtn.textContent = 'Next level';
      }

      overlay.classList.add('win');
      playSound(soundWin);
    }

    gameOver = true;
    items.forEach(item => item.style.pointerEvents = 'none');
    updateHintUI();
  }

  function showMissMarker(evt) {
    const rect = game.getBoundingClientRect();
    const x = evt.clientX - rect.left;
    const y = evt.clientY - rect.top;

    const marker = document.createElement('div');
    marker.className = 'miss-marker';
    marker.style.left = x + 'px';
    marker.style.top  = y + 'px';

    game.appendChild(marker);

    requestAnimationFrame(() => marker.classList.add('visible'));

    setTimeout(() => { marker.remove(); }, 400);
  }

  function resetLevelState() {
    foundCount = 0;
    lives      = maxLives;
    hintsLeft  = maxHints;
    gameOver   = false;

    adRevivesLeft = MAX_AD_REVIVES_PER_LEVEL;
    if (reviveBtn) reviveBtn.style.display = 'none';

    foundCountEl.textContent = '0';
    totalCountEl.textContent = items.length;

    updateLivesUI();
    updateHintUI();
    updateScoreUI();
    updateGameLevelLabel();

    overlay.classList.remove('visible', 'win', 'lose');

    items.forEach(item => {
      item.dataset.found = 'false';
      item.style.opacity = '1';
      item.style.transform = '';
      item.style.pointerEvents = 'auto';
      item.classList.remove('hint-highlight');
    });

    carousel.querySelectorAll('.carousel-item').forEach(slide => slide.classList.remove('found'));
  }

  // Event delegation for item clicks
  game.addEventListener('click', (e) => {
    const item = e.target.closest('.item');
    if (!item) return;
    onItemClick(item);
  });

  function onItemClick(item) {
    if (gameOver) return;
    if (settingsOverlay.classList.contains('visible')) return;
    if (item.dataset.found === 'true') return;

    item.dataset.found = 'true';
    foundCount++;
    foundCountEl.textContent = foundCount;

    playSound(soundHit);
    addScore(10);

    item.style.opacity = '0';
    item.style.transform = 'scale(0.8)';
    item.style.pointerEvents = 'none';

    if (item._carouselItem) item._carouselItem.classList.add('found');

    saveInProgress('found');

    if (foundCount === items.length) {
      unlockLevel(currentLevelIndex + 2);
      clearInProgress();

      setTimeout(() => {
        const isLast = (currentLevelIndex === LEVELS.length - 1);
        if (isLast) {
          showOverlay('You found everything! üéâ', 'Great job! All objects have been collected.', 'win');
        } else {
          const nextLevel = LEVELS[currentLevelIndex + 1];
          showOverlay(
            `Level ${LEVELS[currentLevelIndex].id} complete!`,
            `Next level "${nextLevel.menuTitle}" unlocked.`,
            'win'
          );
        }
      }, 250);
    }
  }

  game.addEventListener('click', (evt) => {
    if (gameOver) return;
    if (settingsOverlay.classList.contains('visible')) return;
    if (evt.target.classList.contains('item')) return;
    if (evt.target.closest('.overlay')) return;
    if (evt.target.closest('.settings-overlay')) return;
    if (evt.target === menuButton || evt.target === hintButton) return;

    lives--;
    updateLivesUI();
    showMissMarker(evt);
    playSound(soundMiss);

    saveInProgress('miss');

    if (lives <= 0) {
      showOverlay('Game over üíÄ', 'You used all lives. Try again!', 'lose');
      saveInProgress('lose');
    }
  });

  // Revive (extra life) via ad stub
  reviveBtn && reviveBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    if (!gameOver) return;
    if (adRevivesLeft <= 0) return;

    showRewardedAdStub({
      title: 'Rewarded Ad (stub)',
      text: 'Stub: –Ω–∞–∂–º–∏ ‚ÄúGet reward‚Äù ‚Äî –∏ –ø–æ–ª—É—á–∏—à—å +1 –∂–∏–∑–Ω—å.',
      onReward: () => {
        adRevivesLeft = Math.max(0, adRevivesLeft - 1);

        lives = 1;
        updateLivesUI();

        gameOver = false;
        overlay.classList.remove('visible', 'win', 'lose');

        items.forEach(item => {
          if (item.dataset.found !== 'true') item.style.pointerEvents = 'auto';
        });

        updateHintUI();

        if (reviveBtn) {
          reviveBtn.style.display = (adRevivesLeft > 0) ? 'block' : 'none';
          reviveBtn.textContent = `Watch ad ‚Äî get +1 life (${adRevivesLeft})`;
        }

        saveInProgress('revive');
      }
    });
  });

  restartBtn.addEventListener('click', () => {
    clearInProgress();

    if (overlayMode === 'next-level' && currentLevelIndex < LEVELS.length - 1) {
      currentLevelIndex++;
      applyLevelInfoToMenu(currentLevelIndex);
      buildLevel(currentLevelIndex);
      resetLevelState();
      startLevelMusic(currentLevelIndex);
      requestAnimationFrame(layoutItems);
    } else {
      resetLevelState();
      startLevelMusic(currentLevelIndex);
      requestAnimationFrame(layoutItems);
    }
  });

  settingsRestart.addEventListener('click', () => {
    clearInProgress();

    resetLevelState();
    settingsOverlay.classList.remove('visible');
    updateHintUI();
    startLevelMusic(currentLevelIndex);
    requestAnimationFrame(layoutItems);
  });

  settingsExitBtn.addEventListener('click', () => {
    saveInProgress('exit');

    settingsOverlay.classList.remove('visible');
    applyLevelInfoToMenu(currentLevelIndex);
    setActiveScreen(menuScreen);
    startMenuMusic();
  });

  // ===== AUTH FUNCTIONS =====
  function getCurrentAuthStatus() {
    if (typeof coreSDK !== 'undefined' && coreSDK.getAuthStatus) {
      return coreSDK.getAuthStatus();
    }
    return { isAuthenticated: false, authType: null, isAnonymous: false };
  }

  function applyAuthUI() {
    const status = getCurrentAuthStatus();
    // Guest button: only show if not authenticated
    const showGuest = !status || !status.isAuthenticated;
    // Google button: show if not authenticated OR if guest/anonymous (can upgrade)
    const showGoogle =
      !status ||
      !status.isAuthenticated ||
      (status.isAuthenticated && (status.authType === null || status.authType === 'guest' || status.isAnonymous));
    // Logout button: show if authenticated
    const showLogout = status ? status.isAuthenticated : false;

    loginGuestButton.style.display = showGuest ? 'block' : 'none';
    loginGoogleButton.style.display = showGoogle ? 'block' : 'none';
    logoutButton.style.display = showLogout ? 'block' : 'none';

    // Update status message
    let message = 'Not logged in';
    if (status && status.isAuthenticated) {
      if (status.authType === 'google' && !status.isAnonymous) {
        message = 'Logged in with Google';
        authStatusEl.classList.add('logged-in');
      } else if (status.authType === 'guest' || status.isAnonymous) {
        message = 'Logged in as Guest. You can upgrade to Google.';
        authStatusEl.classList.add('logged-in');
      } else {
        message = `Logged in (${status.authType || 'unknown'})`;
        authStatusEl.classList.add('logged-in');
      }
    } else {
      authStatusEl.classList.remove('logged-in');
    }
    authStatusEl.textContent = message;
  }

  function setAuthLoading(isLoading) {
    loginGuestButton.disabled = isLoading;
    loginGoogleButton.disabled = isLoading;
    logoutButton.disabled = isLoading;
    if (isLoading) {
      authStatusEl.textContent = 'Loading...';
    }
  }

  async function handleGuestLogin() {
    try {
      setAuthLoading(true);
      await coreSDK.loginAsGuest();
      applyAuthUI();
    } catch (err) {
      console.error('Guest login error:', err);
      authStatusEl.textContent = 'Login failed';
    } finally {
      setAuthLoading(false);
    }
  }

  async function handleGoogleLogin() {
    try {
      setAuthLoading(true);
      const { credential } = await coreSDK.getGoogleIdToken();
      await coreSDK.loginWithGoogle(credential);
      applyAuthUI();
    } catch (err) {
      console.error('Google login error:', err);
      authStatusEl.textContent = 'Login failed';
    } finally {
      setAuthLoading(false);
    }
  }

  async function handleLogout() {
    try {
      setAuthLoading(true);
      await coreSDK.logout();
      applyAuthUI();
    } catch (err) {
      console.error('Logout error:', err);
      authStatusEl.textContent = 'Logout failed';
    } finally {
      setAuthLoading(false);
    }
  }

  // Auth event listeners
  loginGuestButton.addEventListener('click', handleGuestLogin);
  loginGoogleButton.addEventListener('click', handleGoogleLogin);
  logoutButton.addEventListener('click', handleLogout);

  // Initialize auth UI on load
  applyAuthUI();

  function openSettings(context) {
    settingsOverlay.classList.add('visible');
    settingsOverlay.dataset.context = context;

    if (context === 'menu') {
      if (settingsSectionLinks)   settingsSectionLinks.style.display = 'flex';
      if (settingsSectionActions) settingsSectionActions.style.display = 'none';
    } else {
      if (settingsSectionLinks)   settingsSectionLinks.style.display = 'none';
      if (settingsSectionActions) settingsSectionActions.style.display = 'flex';
    }

    updateHintUI();
  }

  menuButton.addEventListener('click', (e) => { e.stopPropagation(); openSettings('game'); });
  mainSettingsButton.addEventListener('click', (e) => { e.stopPropagation(); openSettings('menu'); });

  settingsCloseBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    settingsOverlay.classList.remove('visible');
    updateHintUI();
  });

  settingsOverlay.addEventListener('click', (e) => {
    if (!e.target.closest('.settings-panel')) {
      settingsOverlay.classList.remove('visible');
      updateHintUI();
    }
  });

  soundToggle.addEventListener('click', () => setSoundEnabled(!soundEnabled));

  // Hint logic (game): if 0 -> show ad stub, reward +1 hint and use immediately
  function useHintNow() {
    if (gameOver) return;
    if (settingsOverlay.classList.contains('visible')) return;
    if (hintsLeft <= 0) return;

    const remaining = items.filter(item => item.dataset.found !== 'true');
    if (remaining.length === 0) return;

    const target = remaining[Math.floor(Math.random() * remaining.length)];
    target.classList.add('hint-highlight');

    hintsLeft--;
    updateHintUI();
    saveInProgress('hint');

    setTimeout(() => target.classList.remove('hint-highlight'), 1600);
  }

  hintButton.addEventListener('click', (e) => {
    e.stopPropagation();
    if (gameOver) return;
    if (settingsOverlay.classList.contains('visible')) return;

    const remaining = items.filter(item => item.dataset.found !== 'true');
    if (remaining.length === 0) return;

    if (hintsLeft <= 0) {
      showRewardedAdStub({
        title: 'Rewarded Ad (stub)',
        text: 'Stub: –Ω–∞–∂–º–∏ ‚ÄúGet reward‚Äù ‚Äî –∏ –ø–æ–ª—É—á–∏—à—å –ø–æ–¥—Å–∫–∞–∑–∫—É.',
        onReward: () => {
          hintsLeft = Math.min(maxHints, hintsLeft + 1);
          updateHintUI();
          saveInProgress('ad_hint');
          useHintNow();
        }
      });
      return;
    }

    useHintNow();
  });

  carousel.addEventListener('wheel', (e) => {
    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
      e.preventDefault();
      carousel.scrollLeft += e.deltaY;
    }
  }, { passive: false });

  function updateTutorialHintUI() {
    tutorialHintButton.dataset.hints = tutorialHints;
    tutorialHintsCount.textContent = tutorialHints;
    tutorialHintButton.disabled = tutorialOverlay.classList.contains('visible');
  }

  // build tutorial carousel once
  tutorialItems.forEach((item, index) => {
    const slide = document.createElement('div');
    slide.className = 'carousel-item';

    const icon = document.createElement('img');
    icon.className = 'carousel-icon';
    icon.src = item.getAttribute('src');
    icon.alt = item.dataset.name || `Item ${index + 1}`;

    const label = document.createElement('div');
    label.className = 'carousel-label';
    label.textContent = item.dataset.name || `Item ${index + 1}`;

    slide.appendChild(icon);
    slide.appendChild(label);

    item._carouselItem = slide;
    tutorialCarousel.appendChild(slide);
  });

  function startTutorialGuide() {
    tutorialGuideActive = true;
    tutorialFocusItem = tutorialItems[0];
    if (!tutorialFocusItem) return;
    tutorialGuideOverlay.classList.add('visible');
    tutorialFocusItem.classList.add('tutorial-focus', 'hint-highlight');
  }

  tutorialItems.forEach(item => {
    item.addEventListener('click', () => {
      if (tutorialOverlay.classList.contains('visible')) return;

      if (tutorialGuideActive && item !== tutorialFocusItem) return;
      if (item.dataset.found === 'true') return;

      item.dataset.found = 'true';
      tutorialFound++;

      playSound(soundHit);

      item.style.opacity = '0';
      item.style.transform = 'scale(0.8)';
      item.style.pointerEvents = 'none';

      if (item._carouselItem) item._carouselItem.classList.add('found');

      if (tutorialGuideActive && item === tutorialFocusItem) {
        tutorialGuideActive = false;
        tutorialGuideOverlay.classList.remove('visible');
        item.classList.remove('tutorial-focus', 'hint-highlight');
      }

      if (tutorialFound === tutorialItems.length) tutorialOverlay.classList.add('visible');
    });
  });

  // Tutorial hint logic: if 0 -> show ad stub, reward +1 hint and use immediately
  function useTutorialHintNow(){
    if (tutorialHints <= 0) return;
    if (tutorialOverlay.classList.contains('visible')) return;

    const remaining = Array.from(tutorialItems).filter(item => item.dataset.found !== 'true');
    if (remaining.length === 0) return;

    const target = remaining[Math.floor(Math.random() * remaining.length)];
    target.classList.add('hint-highlight');

    tutorialHints--;
    updateTutorialHintUI();

    setTimeout(() => target.classList.remove('hint-highlight'), 1600);
  }

  tutorialHintButton.addEventListener('click', (e) => {
    e.stopPropagation();
    if (tutorialOverlay.classList.contains('visible')) return;

    const remaining = Array.from(tutorialItems).filter(item => item.dataset.found !== 'true');
    if (remaining.length === 0) return;

    if (tutorialHints <= 0) {
      showRewardedAdStub({
        title: 'Rewarded Ad (stub)',
        text: 'Stub: –Ω–∞–∂–º–∏ ‚ÄúGet reward‚Äù ‚Äî –∏ –ø–æ–ª—É—á–∏—à—å –ø–æ–¥—Å–∫–∞–∑–∫—É.',
        onReward: () => {
          tutorialHints = Math.min(2, tutorialHints + 1);
          updateTutorialHintUI();
          useTutorialHintNow();
        }
      });
      return;
    }

    useTutorialHintNow();
  });

  function finishTutorialToMenu(){
    markUserCompletedTutorial();

    tutorialOverlay.classList.remove('visible');
    tutorialGuideOverlay.classList.remove('visible');
    if (tutorialFocusItem) tutorialFocusItem.classList.remove('tutorial-focus', 'hint-highlight');
    setActiveScreen(menuScreen);
    applyLevelInfoToMenu(currentLevelIndex);
    startMenuMusic();
  }

  tutorialContinueBtn.addEventListener('click', finishTutorialToMenu);
  tutorialSkipBtn.addEventListener('click', (e) => { e.stopPropagation(); finishTutorialToMenu(); });

  function initTutorial() {
    tutorialFound = 0;
    tutorialHints = 2;
    tutorialGuideActive = false;
    tutorialFocusItem = null;

    tutorialItems.forEach(it => {
      it.dataset.found = 'false';
      it.style.opacity = '1';
      it.style.transform = '';
      it.style.pointerEvents = 'auto';
      it.classList.remove('tutorial-focus', 'hint-highlight');
      if (it._carouselItem) it._carouselItem.classList.remove('found');
    });

    updateTutorialHintUI();
    initTutorialLayout();
    updateScoreUI();
    updatePlayerUI();
    startTutorialGuide();
    requestAnimationFrame(layoutTutorialItems);
  }

  loginSubmitBtn.addEventListener('click', () => {
    const email = loginEmailInput.value.trim();
    const password = loginPasswordInput.value.trim();
    if (authMode === 'login') performLogin(email, password);
    else performRegistration(registerNameInput.value.trim(), email, password);
  });

  loginAutofillBtn.addEventListener('click', () => {
    loginEmailInput.value = 'admin@gmail.com';
    loginPasswordInput.value = 'admin';
    performLogin('admin@gmail.com', 'admin');
  });

  loginGoogleBtn.addEventListener('click', () => {
    loginErrorText.textContent = 'Google login stub ‚Äì not implemented yet.';
  });

  switchAuthModeBtn.addEventListener('click', () => {
    authMode = authMode === 'login' ? 'register' : 'login';
    applyAuthMode();
  });

  function handleAuthEnter(e) {
    if (e.key === 'Enter') {
      const email = loginEmailInput.value.trim();
      const password = loginPasswordInput.value.trim();
      if (authMode === 'login') performLogin(email, password);
      else performRegistration(registerNameInput.value.trim(), email, password);
    }
  }

  loginEmailInput.addEventListener('keydown', handleAuthEnter);
  loginPasswordInput.addEventListener('keydown', handleAuthEnter);
  registerNameInput.addEventListener('keydown', handleAuthEnter);

  loginAvatar.addEventListener('click', () => {
    if (authMode !== 'register') return;
    avatarFileInput && avatarFileInput.click();
  });

  avatarFileInput && avatarFileInput.addEventListener('change', (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      const dataUrl = ev.target.result;
      if (typeof dataUrl === 'string') {
        playerAvatarSymbol = dataUrl;
        updatePlayerUI();
      }
    };
    reader.readAsDataURL(file);
  });

  scoreboardButton && scoreboardButton.addEventListener('click', () => {
    setActiveScreen(scoreScreen);
    updateScoreUI();
    startMenuMusic();
  });

  function backToMenuFromScore() {
    setActiveScreen(menuScreen);
    updateScoreUI();
    startMenuMusic();
  }

  scoreBackButton && scoreBackButton.addEventListener('click', backToMenuFromScore);
  scoreBackBottomButton && scoreBackBottomButton.addEventListener('click', backToMenuFromScore);

  function startGameWithRestore(levelIndex) {
    setActiveScreen(gameScreen);
    buildLevel(levelIndex);

    const restored = restoreInProgressIfAny(levelIndex);
    if (!restored) {
      resetLevelState();
      if (!hasInProgressForLevel(levelIndex)) clearInProgress();
    }

    startLevelMusic(levelIndex);
    requestAnimationFrame(layoutItems);
  }

  playButton.addEventListener('click', () => {
    startGameWithRestore(currentLevelIndex);
  });

  // ‚úÖ confirm popup (English)
  startFromBeginningButton.addEventListener('click', () => {
    const ok = confirm('Do you really want to reset progress?');
    if (!ok) return;

    clearInProgress();

    maxUnlockedLevel = 1;
    currentLevelIndex = 0;
    saveProgress();
    applyLevelInfoToMenu(currentLevelIndex);
    startGameWithRestore(currentLevelIndex);
  });

  (function enablePressFeedback(){
    let currentPressed = null;

    function getBtn(target){
      return target && target.closest && target.closest('button, .btn, .play-btn, .menu-settings-btn, .menu-button, .hint-button, .tutorial-skip-btn, .settings-toggle, .menu-section-btn, .login-switch');
    }

    document.addEventListener('pointerdown', (e) => {
      const b = getBtn(e.target);
      if (!b || b.disabled) return;
      if (currentPressed && currentPressed !== b) {
        currentPressed.classList.remove('is-pressed');
      }
      currentPressed = b;
      b.classList.add('is-pressed');
    }, true);

    function clearPressed(){
      if (currentPressed) {
        currentPressed.classList.remove('is-pressed');
        currentPressed = null;
      }
    }
    document.addEventListener('pointerup', clearPressed, true);
    document.addEventListener('pointercancel', clearPressed, true);
    document.addEventListener('pointerleave', clearPressed, true);

    document.addEventListener('keydown', (e) => {
      if (e.key !== 'Enter' && e.key !== ' ') return;
      const b = getBtn(document.activeElement);
      if (!b || b.disabled) return;
      if (currentPressed && currentPressed !== b) {
        currentPressed.classList.remove('is-pressed');
      }
      currentPressed = b;
      b.classList.add('is-pressed');
    }, true);
    document.addEventListener('keyup', (e) => {
      if (e.key !== 'Enter' && e.key !== ' ') return;
      clearPressed();
    }, true);
  })();

  // auto-save on leaving/hiding
  window.addEventListener('pagehide', () => {
    if (gameScreen.classList.contains('active') && foundCount < items.length) {
      saveInProgress('pagehide');
    }
  });

  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'hidden') {
      if (gameScreen.classList.contains('active') && foundCount < items.length) {
        saveInProgress('hidden');
      }
    }
  });
}
</script>
  <script src="./Find Objects ‚Äì Multi-level with Tutorial_files/game-sdk.umd.af641715.js"></script>
  <script>
    (function() {
      const MAX_RETRIES = 20;
      let retries = 0;

      function tryInitSDK() {
        if (typeof coreSDK !== 'undefined') {
          coreSDK.init({
            app: "test-frontend",
            skipAuth: false,
          }, startAiGame);
        } else if (retries < MAX_RETRIES) {
          retries++;
          setTimeout(tryInitSDK, 500);
        } else {
          console.error('[SDK] Failed to load after ' + (MAX_RETRIES * 500) + 'ms');
        }
      }
      tryInitSDK();
    })();
  </script>


</body></html>